<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Loki Mode Dashboard - Self-contained autonomous AI system monitor">
  <meta name="theme-color" content="#8b5cf6">
  <title>Loki Mode Dashboard</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%238b5cf6' rx='15' width='100' height='100'/><text x='50' y='72' font-size='60' font-weight='bold' text-anchor='middle' fill='white'>L</text></svg>">
  <style>
    /* CSS Reset and Base Styles */
    :root {
      /* Dark theme (default) */
      --loki-bg-primary: #09090b;
      --loki-bg-secondary: #0c0c0f;
      --loki-bg-tertiary: #111114;
      --loki-bg-card: #18181b;
      --loki-bg-hover: #1f1f23;
      --loki-text-primary: #fafafa;
      --loki-text-secondary: #a1a1aa;
      --loki-text-muted: #52525b;
      --loki-accent: #8b5cf6;
      --loki-accent-hover: #a78bfa;
      --loki-border: rgba(255, 255, 255, 0.06);
      --loki-border-light: rgba(255, 255, 255, 0.1);
      --loki-success: #22c55e;
      --loki-warning: #eab308;
      --loki-error: #ef4444;
      --loki-info: #3b82f6;
      --loki-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --loki-bg-primary: #fafafa;
        --loki-bg-secondary: #f4f4f5;
        --loki-bg-tertiary: #e4e4e7;
        --loki-bg-card: #ffffff;
        --loki-bg-hover: #f0f0f3;
        --loki-text-primary: #18181b;
        --loki-text-secondary: #52525b;
        --loki-text-muted: #a1a1aa;
        --loki-accent: #7c3aed;
        --loki-accent-hover: #6d28d9;
        --loki-border: #e4e4e7;
        --loki-border-light: #d4d4d8;
        --loki-success: #16a34a;
        --loki-warning: #ca8a04;
        --loki-error: #dc2626;
        --loki-info: #2563eb;
      }
    }

    [data-loki-theme="dark"] {
      --loki-bg-primary: #09090b;
      --loki-bg-secondary: #0c0c0f;
      --loki-bg-tertiary: #111114;
      --loki-bg-card: #18181b;
      --loki-bg-hover: #1f1f23;
      --loki-text-primary: #fafafa;
      --loki-text-secondary: #a1a1aa;
      --loki-text-muted: #52525b;
      --loki-accent: #8b5cf6;
      --loki-accent-hover: #a78bfa;
      --loki-border: rgba(255, 255, 255, 0.06);
      --loki-border-light: rgba(255, 255, 255, 0.1);
      --loki-success: #22c55e;
      --loki-warning: #eab308;
      --loki-error: #ef4444;
      --loki-info: #3b82f6;
    }

    [data-loki-theme="light"] {
      --loki-bg-primary: #fafafa;
      --loki-bg-secondary: #f4f4f5;
      --loki-bg-tertiary: #e4e4e7;
      --loki-bg-card: #ffffff;
      --loki-bg-hover: #f0f0f3;
      --loki-text-primary: #18181b;
      --loki-text-secondary: #52525b;
      --loki-text-muted: #a1a1aa;
      --loki-accent: #7c3aed;
      --loki-accent-hover: #6d28d9;
      --loki-border: #e4e4e7;
      --loki-border-light: #d4d4d8;
      --loki-success: #16a34a;
      --loki-warning: #ca8a04;
      --loki-error: #dc2626;
      --loki-info: #2563eb;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--loki-bg-primary);
      color: var(--loki-text-primary);
      min-height: 100vh;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background var(--loki-transition), color var(--loki-transition);
    }

    /* Dashboard Layout */
    .dashboard-layout {
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 1fr;
      min-height: 100vh;
    }

    @media (max-width: 768px) {
      .dashboard-layout {
        grid-template-columns: 1fr;
      }
      .sidebar { display: none; }
      .sidebar.mobile-open {
        display: flex;
        position: fixed;
        left: 0; top: 0; bottom: 0;
        width: 240px;
        z-index: 100;
      }
    }

    /* Sidebar */
    .sidebar {
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-right: 1px solid var(--loki-border);
      overflow-y: auto;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 20px 16px 16px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #8b5cf6, #6d28d9);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
      color: white;
    }

    .logo-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--loki-text-primary);
    }

    /* Navigation */
    .nav-links {
      display: flex;
      flex-direction: column;
      padding: 8px;
      gap: 2px;
      flex: 1;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--loki-text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      border: 1px solid transparent;
      background: none;
      text-align: left;
      width: 100%;
      font-family: inherit;
    }

    .nav-link:hover {
      color: var(--loki-text-primary);
      background: rgba(255, 255, 255, 0.04);
    }

    .nav-link.active {
      color: #fafafa;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.08));
      border-color: rgba(139, 92, 246, 0.15);
    }

    .nav-link svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
      stroke-width: 2;
      fill: none;
      flex-shrink: 0;
    }

    /* Sidebar footer */
    .sidebar-footer {
      padding: 12px;
      border-top: 1px solid var(--loki-border);
    }

    .sidebar-controls {
      display: flex;
      gap: 6px;
      align-items: center;
      padding: 8px 4px 0;
    }

    .theme-toggle, .api-btn {
      padding: 5px 10px;
      background: var(--loki-bg-tertiary);
      border: 1px solid var(--loki-border);
      border-radius: 6px;
      font-size: 11px;
      color: var(--loki-text-secondary);
      cursor: pointer;
      transition: all var(--loki-transition);
      font-family: inherit;
    }

    .theme-toggle:hover, .api-btn:hover {
      background: var(--loki-bg-hover);
      color: var(--loki-text-primary);
    }

    .api-url-input {
      padding: 5px 8px;
      background: var(--loki-bg-card);
      border: 1px solid var(--loki-border);
      border-radius: 6px;
      font-size: 11px;
      font-family: 'JetBrains Mono', monospace;
      color: var(--loki-text-primary);
      flex: 1;
      min-width: 0;
    }

    .api-url-input:focus {
      outline: none;
      border-color: var(--loki-accent);
    }

    /* Main Content */
    .main-content {
      padding: 24px 28px;
      overflow-y: auto;
      height: 100vh;
      scroll-behavior: smooth;
    }

    /* Section pages */
    .section-page {
      padding-bottom: 32px;
    }

    .section-page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-top: 4px;
    }

    .section-page-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--loki-text-primary);
    }

    /* Overview grid */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 8px;
    }

    .overview-card {
      background: var(--loki-bg-card);
      border: 1px solid var(--loki-border);
      border-radius: 10px;
      padding: 20px;
      transition: border-color 0.2s;
    }

    .overview-card:hover {
      border-color: var(--loki-border-light);
    }

    .overview-card-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--loki-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .overview-card-value {
      font-size: 24px;
      font-weight: 600;
      color: var(--loki-text-primary);
    }

    /* Offline Banner */
    .offline-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--loki-warning);
      color: #18181b;
      padding: 8px 16px;
      text-align: center;
      font-size: 13px;
      font-weight: 500;
      display: none;
      z-index: 999;
    }

    .offline-banner.show {
      display: block;
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--loki-text-muted);
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      margin-left: 10px;
      border: 2px solid var(--loki-border);
      border-top-color: var(--loki-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile menu button */
    .mobile-menu-btn {
      display: none;
      padding: 8px;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--loki-text-primary);
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.15); }
  </style>
</head>
<body>
  <!-- Offline Banner -->
  <div class="offline-banner" id="offline-banner">
    Offline - showing cached data
  </div>

  <!-- Dashboard Layout -->
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle menu">
          <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <div class="logo-icon">L</div>
        <span class="logo-text">Loki Mode</span>
      </div>

      <nav class="nav-links">
        <button class="nav-link active" data-section="overview" id="nav-overview">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Overview
        </button>
        <button class="nav-link" data-section="tasks" id="nav-tasks">
          <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
          Tasks
        </button>
        <button class="nav-link" data-section="logs" id="nav-logs">
          <svg viewBox="0 0 24 24"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
          Logs
        </button>
        <button class="nav-link" data-section="memory" id="nav-memory">
          <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
          Memory
        </button>
        <button class="nav-link" data-section="learning" id="nav-learning">
          <svg viewBox="0 0 24 24"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
          Learning
        </button>
        <button class="nav-link" data-section="council" id="nav-council">
          <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
          Council
        </button>
      </nav>

      <div class="sidebar-footer">
        <loki-session-control id="session-control"></loki-session-control>
        <div class="sidebar-controls">
          <input type="text" class="api-url-input" id="api-url" placeholder="API URL">
          <button class="api-btn" id="connect-btn">Go</button>
          <button class="theme-toggle" id="theme-toggle">
            <span id="theme-label">Light</span>
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
      <!-- Overview (default) -->
      <div class="section-page" id="page-overview">
        <div class="section-page-header">
          <h2 class="section-page-title">Overview</h2>
        </div>
        <div class="overview-grid">
          <div class="overview-card">
            <div class="overview-card-label">Session</div>
            <div class="overview-card-value" id="overview-status">--</div>
          </div>
          <div class="overview-card">
            <div class="overview-card-label">Iteration</div>
            <div class="overview-card-value" id="overview-iteration">--</div>
          </div>
          <div class="overview-card">
            <div class="overview-card-label">Tasks</div>
            <div class="overview-card-value" id="overview-tasks">--</div>
          </div>
          <div class="overview-card">
            <div class="overview-card-label">Model</div>
            <div class="overview-card-value" id="overview-model">--</div>
          </div>
        </div>
      </div>

      <!-- Task Board -->
      <div class="section-page" id="page-tasks">
        <div class="section-page-header">
          <h2 class="section-page-title">Tasks</h2>
        </div>
        <loki-task-board id="task-board"></loki-task-board>
      </div>

      <!-- Log Stream -->
      <div class="section-page" id="page-logs">
        <div class="section-page-header">
          <h2 class="section-page-title">Logs</h2>
        </div>
        <loki-log-stream id="log-stream" auto-scroll max-lines="500"></loki-log-stream>
      </div>

      <!-- Memory Browser -->
      <div class="section-page" id="page-memory">
        <div class="section-page-header">
          <h2 class="section-page-title">Memory</h2>
        </div>
        <loki-memory-browser id="memory-browser" tab="summary"></loki-memory-browser>
      </div>

      <!-- Learning Dashboard -->
      <div class="section-page" id="page-learning">
        <div class="section-page-header">
          <h2 class="section-page-title">Learning Metrics</h2>
        </div>
        <loki-learning-dashboard id="learning-dashboard" time-range="7d"></loki-learning-dashboard>
      </div>

      <!-- Completion Council -->
      <div class="section-page" id="page-council">
        <div class="section-page-header">
          <h2 class="section-page-title">Completion Council</h2>
        </div>
        <loki-council-dashboard id="council-dashboard"></loki-council-dashboard>
      </div>
    </main>
  </div>

  <!-- Inlined JavaScript Bundle -->
  <script>
var LokiDashboard=(()=>{var H=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ie=(l,e,t)=>e in l?H(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var re=(l,e)=>{for(var t in e)H(l,t,{get:e[t],enumerable:!0})},oe=(l,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ae(e))!se.call(l,s)&&s!==t&&H(l,s,{get:()=>e[s],enumerable:!(a=te(e,s))||a.enumerable});return l};var ne=l=>oe(H({},"__esModule",{value:!0}),l);var k=(l,e,t)=>ie(l,typeof e!="symbol"?e+"":e,t);var me={};re(me,{ANIMATION:()=>w,ARIA_PATTERNS:()=>q,ApiEvents:()=>n,BASE_STYLES:()=>R,BREAKPOINTS:()=>F,COMMON_STYLES:()=>J,KEYBOARD_SHORTCUTS:()=>N,KeyboardHandler:()=>C,LokiApiClient:()=>L,LokiCouncilDashboard:()=>O,LokiElement:()=>u,LokiLearningDashboard:()=>U,LokiLogStream:()=>j,LokiMemoryBrowser:()=>B,LokiSessionControl:()=>z,LokiState:()=>I,LokiTaskBoard:()=>M,LokiTheme:()=>S,RADIUS:()=>y,SPACING:()=>x,STATE_CHANGE_EVENT:()=>G,THEMES:()=>b,THEME_VARIABLES:()=>K,TYPOGRAPHY:()=>v,UnifiedThemeManager:()=>h,VERSION:()=>he,Z_INDEX:()=>$,createApiClient:()=>Z,createStore:()=>Q,generateThemeCSS:()=>m,generateTokensCSS:()=>P,getApiClient:()=>g,getState:()=>A,init:()=>ve});var b={light:{"--loki-bg-primary":"#fafafa","--loki-bg-secondary":"#f4f4f5","--loki-bg-tertiary":"#e4e4e7","--loki-bg-card":"#ffffff","--loki-bg-hover":"#f0f0f3","--loki-bg-active":"#e8e8ec","--loki-bg-overlay":"rgba(0, 0, 0, 0.5)","--loki-accent":"#7c3aed","--loki-accent-hover":"#6d28d9","--loki-accent-active":"#5b21b6","--loki-accent-light":"#8b5cf6","--loki-accent-muted":"rgba(124, 58, 237, 0.12)","--loki-text-primary":"#18181b","--loki-text-secondary":"#52525b","--loki-text-muted":"#a1a1aa","--loki-text-disabled":"#d4d4d8","--loki-text-inverse":"#ffffff","--loki-border":"#e4e4e7","--loki-border-light":"#d4d4d8","--loki-border-focus":"#7c3aed","--loki-success":"#16a34a","--loki-success-muted":"rgba(22, 163, 74, 0.12)","--loki-warning":"#ca8a04","--loki-warning-muted":"rgba(202, 138, 4, 0.12)","--loki-error":"#dc2626","--loki-error-muted":"rgba(220, 38, 38, 0.12)","--loki-info":"#2563eb","--loki-info-muted":"rgba(37, 99, 235, 0.12)","--loki-green":"#16a34a","--loki-green-muted":"rgba(22, 163, 74, 0.12)","--loki-yellow":"#ca8a04","--loki-yellow-muted":"rgba(202, 138, 4, 0.12)","--loki-red":"#dc2626","--loki-red-muted":"rgba(220, 38, 38, 0.12)","--loki-blue":"#2563eb","--loki-blue-muted":"rgba(37, 99, 235, 0.12)","--loki-purple":"#9333ea","--loki-purple-muted":"rgba(147, 51, 234, 0.12)","--loki-opus":"#d97706","--loki-sonnet":"#4f46e5","--loki-haiku":"#059669","--loki-shadow-sm":"0 1px 2px rgba(0, 0, 0, 0.05)","--loki-shadow-md":"0 4px 6px rgba(0, 0, 0, 0.07)","--loki-shadow-lg":"0 10px 15px rgba(0, 0, 0, 0.1)","--loki-shadow-focus":"0 0 0 3px rgba(124, 58, 237, 0.3)"},dark:{"--loki-bg-primary":"#09090b","--loki-bg-secondary":"#0c0c0f","--loki-bg-tertiary":"#111114","--loki-bg-card":"#18181b","--loki-bg-hover":"#1f1f23","--loki-bg-active":"#27272a","--loki-bg-overlay":"rgba(0, 0, 0, 0.8)","--loki-accent":"#8b5cf6","--loki-accent-hover":"#a78bfa","--loki-accent-active":"#7c3aed","--loki-accent-light":"#a78bfa","--loki-accent-muted":"rgba(139, 92, 246, 0.15)","--loki-text-primary":"#fafafa","--loki-text-secondary":"#a1a1aa","--loki-text-muted":"#52525b","--loki-text-disabled":"#3f3f46","--loki-text-inverse":"#09090b","--loki-border":"rgba(255, 255, 255, 0.06)","--loki-border-light":"rgba(255, 255, 255, 0.1)","--loki-border-focus":"#8b5cf6","--loki-success":"#22c55e","--loki-success-muted":"rgba(34, 197, 94, 0.15)","--loki-warning":"#eab308","--loki-warning-muted":"rgba(234, 179, 8, 0.15)","--loki-error":"#ef4444","--loki-error-muted":"rgba(239, 68, 68, 0.15)","--loki-info":"#3b82f6","--loki-info-muted":"rgba(59, 130, 246, 0.15)","--loki-green":"#22c55e","--loki-green-muted":"rgba(34, 197, 94, 0.15)","--loki-yellow":"#eab308","--loki-yellow-muted":"rgba(234, 179, 8, 0.15)","--loki-red":"#ef4444","--loki-red-muted":"rgba(239, 68, 68, 0.15)","--loki-blue":"#3b82f6","--loki-blue-muted":"rgba(59, 130, 246, 0.15)","--loki-purple":"#a78bfa","--loki-purple-muted":"rgba(167, 139, 250, 0.15)","--loki-opus":"#f59e0b","--loki-sonnet":"#818cf8","--loki-haiku":"#34d399","--loki-shadow-sm":"0 1px 2px rgba(0, 0, 0, 0.4)","--loki-shadow-md":"0 4px 12px rgba(0, 0, 0, 0.5)","--loki-shadow-lg":"0 10px 25px rgba(0, 0, 0, 0.6)","--loki-shadow-focus":"0 0 0 3px rgba(139, 92, 246, 0.25)"},"high-contrast":{"--loki-bg-primary":"#000000","--loki-bg-secondary":"#0a0a0a","--loki-bg-tertiary":"#141414","--loki-bg-card":"#0a0a0a","--loki-bg-hover":"#1a1a1a","--loki-bg-active":"#242424","--loki-bg-overlay":"rgba(0, 0, 0, 0.9)","--loki-accent":"#c084fc","--loki-accent-hover":"#d8b4fe","--loki-accent-active":"#e9d5ff","--loki-accent-light":"#d8b4fe","--loki-accent-muted":"rgba(192, 132, 252, 0.25)","--loki-text-primary":"#ffffff","--loki-text-secondary":"#e0e0e0","--loki-text-muted":"#b0b0b0","--loki-text-disabled":"#666666","--loki-text-inverse":"#000000","--loki-border":"#ffffff","--loki-border-light":"#cccccc","--loki-border-focus":"#c084fc","--loki-success":"#4ade80","--loki-success-muted":"rgba(74, 222, 128, 0.25)","--loki-warning":"#fde047","--loki-warning-muted":"rgba(253, 224, 71, 0.25)","--loki-error":"#f87171","--loki-error-muted":"rgba(248, 113, 113, 0.25)","--loki-info":"#60a5fa","--loki-info-muted":"rgba(96, 165, 250, 0.25)","--loki-green":"#4ade80","--loki-green-muted":"rgba(74, 222, 128, 0.25)","--loki-yellow":"#fde047","--loki-yellow-muted":"rgba(253, 224, 71, 0.25)","--loki-red":"#f87171","--loki-red-muted":"rgba(248, 113, 113, 0.25)","--loki-blue":"#60a5fa","--loki-blue-muted":"rgba(96, 165, 250, 0.25)","--loki-purple":"#c084fc","--loki-purple-muted":"rgba(192, 132, 252, 0.25)","--loki-opus":"#fbbf24","--loki-sonnet":"#818cf8","--loki-haiku":"#34d399","--loki-shadow-sm":"none","--loki-shadow-md":"none","--loki-shadow-lg":"none","--loki-shadow-focus":"0 0 0 3px #c084fc"},"vscode-light":{"--loki-bg-primary":"var(--vscode-editor-background, #ffffff)","--loki-bg-secondary":"var(--vscode-sideBar-background, #f3f3f3)","--loki-bg-tertiary":"var(--vscode-input-background, #ffffff)","--loki-bg-card":"var(--vscode-editor-background, #ffffff)","--loki-bg-hover":"var(--vscode-list-hoverBackground, #e8e8e8)","--loki-bg-active":"var(--vscode-list-activeSelectionBackground, #0060c0)","--loki-bg-overlay":"rgba(0, 0, 0, 0.4)","--loki-accent":"var(--vscode-focusBorder, #0066cc)","--loki-accent-hover":"var(--vscode-button-hoverBackground, #0055aa)","--loki-accent-active":"var(--vscode-button-background, #007acc)","--loki-accent-light":"var(--vscode-focusBorder, #0066cc)","--loki-accent-muted":"var(--vscode-editor-selectionBackground, rgba(0, 102, 204, 0.2))","--loki-text-primary":"var(--vscode-foreground, #333333)","--loki-text-secondary":"var(--vscode-descriptionForeground, #717171)","--loki-text-muted":"var(--vscode-disabledForeground, #a0a0a0)","--loki-text-disabled":"var(--vscode-disabledForeground, #cccccc)","--loki-text-inverse":"var(--vscode-button-foreground, #ffffff)","--loki-border":"var(--vscode-widget-border, #c8c8c8)","--loki-border-light":"var(--vscode-widget-border, #e0e0e0)","--loki-border-focus":"var(--vscode-focusBorder, #0066cc)","--loki-success":"var(--vscode-testing-iconPassed, #388a34)","--loki-success-muted":"rgba(56, 138, 52, 0.15)","--loki-warning":"var(--vscode-editorWarning-foreground, #bf8803)","--loki-warning-muted":"rgba(191, 136, 3, 0.15)","--loki-error":"var(--vscode-errorForeground, #e51400)","--loki-error-muted":"rgba(229, 20, 0, 0.15)","--loki-info":"var(--vscode-editorInfo-foreground, #1a85ff)","--loki-info-muted":"rgba(26, 133, 255, 0.15)","--loki-green":"var(--vscode-testing-iconPassed, #388a34)","--loki-green-muted":"rgba(56, 138, 52, 0.15)","--loki-yellow":"var(--vscode-editorWarning-foreground, #bf8803)","--loki-yellow-muted":"rgba(191, 136, 3, 0.15)","--loki-red":"var(--vscode-errorForeground, #e51400)","--loki-red-muted":"rgba(229, 20, 0, 0.15)","--loki-blue":"var(--vscode-editorInfo-foreground, #1a85ff)","--loki-blue-muted":"rgba(26, 133, 255, 0.15)","--loki-purple":"#9333ea","--loki-purple-muted":"rgba(147, 51, 234, 0.15)","--loki-opus":"#d97706","--loki-sonnet":"#4f46e5","--loki-haiku":"#059669","--loki-shadow-sm":"0 1px 2px rgba(0, 0, 0, 0.05)","--loki-shadow-md":"0 2px 4px rgba(0, 0, 0, 0.1)","--loki-shadow-lg":"0 4px 8px rgba(0, 0, 0, 0.15)","--loki-shadow-focus":"0 0 0 2px var(--vscode-focusBorder, #0066cc)"},"vscode-dark":{"--loki-bg-primary":"var(--vscode-editor-background, #1e1e1e)","--loki-bg-secondary":"var(--vscode-sideBar-background, #252526)","--loki-bg-tertiary":"var(--vscode-input-background, #3c3c3c)","--loki-bg-card":"var(--vscode-editor-background, #1e1e1e)","--loki-bg-hover":"var(--vscode-list-hoverBackground, #2a2d2e)","--loki-bg-active":"var(--vscode-list-activeSelectionBackground, #094771)","--loki-bg-overlay":"rgba(0, 0, 0, 0.6)","--loki-accent":"var(--vscode-focusBorder, #007fd4)","--loki-accent-hover":"var(--vscode-button-hoverBackground, #1177bb)","--loki-accent-active":"var(--vscode-button-background, #0e639c)","--loki-accent-light":"var(--vscode-focusBorder, #007fd4)","--loki-accent-muted":"var(--vscode-editor-selectionBackground, rgba(0, 127, 212, 0.25))","--loki-text-primary":"var(--vscode-foreground, #cccccc)","--loki-text-secondary":"var(--vscode-descriptionForeground, #9d9d9d)","--loki-text-muted":"var(--vscode-disabledForeground, #6b6b6b)","--loki-text-disabled":"var(--vscode-disabledForeground, #4d4d4d)","--loki-text-inverse":"var(--vscode-button-foreground, #ffffff)","--loki-border":"var(--vscode-widget-border, #454545)","--loki-border-light":"var(--vscode-widget-border, #5a5a5a)","--loki-border-focus":"var(--vscode-focusBorder, #007fd4)","--loki-success":"var(--vscode-testing-iconPassed, #89d185)","--loki-success-muted":"rgba(137, 209, 133, 0.2)","--loki-warning":"var(--vscode-editorWarning-foreground, #cca700)","--loki-warning-muted":"rgba(204, 167, 0, 0.2)","--loki-error":"var(--vscode-errorForeground, #f48771)","--loki-error-muted":"rgba(244, 135, 113, 0.2)","--loki-info":"var(--vscode-editorInfo-foreground, #75beff)","--loki-info-muted":"rgba(117, 190, 255, 0.2)","--loki-green":"var(--vscode-testing-iconPassed, #89d185)","--loki-green-muted":"rgba(137, 209, 133, 0.2)","--loki-yellow":"var(--vscode-editorWarning-foreground, #cca700)","--loki-yellow-muted":"rgba(204, 167, 0, 0.2)","--loki-red":"var(--vscode-errorForeground, #f48771)","--loki-red-muted":"rgba(244, 135, 113, 0.2)","--loki-blue":"var(--vscode-editorInfo-foreground, #75beff)","--loki-blue-muted":"rgba(117, 190, 255, 0.2)","--loki-purple":"#c084fc","--loki-purple-muted":"rgba(192, 132, 252, 0.2)","--loki-opus":"#f59e0b","--loki-sonnet":"#818cf8","--loki-haiku":"#34d399","--loki-shadow-sm":"0 1px 2px rgba(0, 0, 0, 0.3)","--loki-shadow-md":"0 2px 4px rgba(0, 0, 0, 0.4)","--loki-shadow-lg":"0 4px 8px rgba(0, 0, 0, 0.5)","--loki-shadow-focus":"0 0 0 2px var(--vscode-focusBorder, #007fd4)"}},x={xs:"4px",sm:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"32px","3xl":"48px"},y={none:"0",sm:"4px",md:"6px",lg:"8px",xl:"10px",full:"9999px"},v={fontFamily:{sans:"'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",mono:"'JetBrains Mono', 'Fira Code', 'SF Mono', Menlo, monospace"},fontSize:{xs:"10px",sm:"11px",base:"12px",md:"13px",lg:"14px",xl:"16px","2xl":"18px","3xl":"24px"},fontWeight:{normal:"400",medium:"500",semibold:"600",bold:"700"},lineHeight:{tight:"1.25",normal:"1.5",relaxed:"1.75"}},w={duration:{fast:"100ms",normal:"200ms",slow:"300ms",slower:"500ms"},easing:{default:"cubic-bezier(0.4, 0, 0.2, 1)",in:"cubic-bezier(0.4, 0, 1, 1)",out:"cubic-bezier(0, 0, 0.2, 1)",bounce:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"}},F={sm:"640px",md:"768px",lg:"1024px",xl:"1280px","2xl":"1536px"},$={base:"0",dropdown:"100",sticky:"200",modal:"300",popover:"400",tooltip:"500",toast:"600"},N={"navigation.nextItem":{key:"ArrowDown",modifiers:[]},"navigation.prevItem":{key:"ArrowUp",modifiers:[]},"navigation.nextSection":{key:"Tab",modifiers:[]},"navigation.prevSection":{key:"Tab",modifiers:["Shift"]},"navigation.confirm":{key:"Enter",modifiers:[]},"navigation.cancel":{key:"Escape",modifiers:[]},"action.refresh":{key:"r",modifiers:["Meta"]},"action.search":{key:"k",modifiers:["Meta"]},"action.save":{key:"s",modifiers:["Meta"]},"action.close":{key:"w",modifiers:["Meta"]},"theme.toggle":{key:"d",modifiers:["Meta","Shift"]},"task.create":{key:"n",modifiers:["Meta"]},"task.complete":{key:"Enter",modifiers:["Meta"]},"view.toggleLogs":{key:"l",modifiers:["Meta","Shift"]},"view.toggleMemory":{key:"m",modifiers:["Meta","Shift"]}},q={button:{role:"button",tabIndex:0},tablist:{role:"tablist"},tab:{role:"tab",ariaSelected:!1,tabIndex:-1},tabpanel:{role:"tabpanel",tabIndex:0},list:{role:"list"},listitem:{role:"listitem"},livePolite:{ariaLive:"polite",ariaAtomic:!0},liveAssertive:{ariaLive:"assertive",ariaAtomic:!0},dialog:{role:"dialog",ariaModal:!0},alertdialog:{role:"alertdialog",ariaModal:!0},status:{role:"status",ariaLive:"polite"},alert:{role:"alert",ariaLive:"assertive"},log:{role:"log",ariaLive:"polite",ariaRelevant:"additions"}};function m(l){let e=b[l];return e?Object.entries(e).map(([t,a])=>`${t}: ${a};`).join(`
    `):""}function P(){return`
    /* Spacing */
    --loki-space-xs: ${x.xs};
    --loki-space-sm: ${x.sm};
    --loki-space-md: ${x.md};
    --loki-space-lg: ${x.lg};
    --loki-space-xl: ${x.xl};
    --loki-space-2xl: ${x["2xl"]};
    --loki-space-3xl: ${x["3xl"]};

    /* Border Radius */
    --loki-radius-none: ${y.none};
    --loki-radius-sm: ${y.sm};
    --loki-radius-md: ${y.md};
    --loki-radius-lg: ${y.lg};
    --loki-radius-xl: ${y.xl};
    --loki-radius-full: ${y.full};

    /* Typography */
    --loki-font-sans: ${v.fontFamily.sans};
    --loki-font-mono: ${v.fontFamily.mono};
    --loki-text-xs: ${v.fontSize.xs};
    --loki-text-sm: ${v.fontSize.sm};
    --loki-text-base: ${v.fontSize.base};
    --loki-text-md: ${v.fontSize.md};
    --loki-text-lg: ${v.fontSize.lg};
    --loki-text-xl: ${v.fontSize.xl};
    --loki-text-2xl: ${v.fontSize["2xl"]};
    --loki-text-3xl: ${v.fontSize["3xl"]};

    /* Animation */
    --loki-duration-fast: ${w.duration.fast};
    --loki-duration-normal: ${w.duration.normal};
    --loki-duration-slow: ${w.duration.slow};
    --loki-easing-default: ${w.easing.default};
    --loki-transition: ${w.duration.normal} ${w.easing.default};

    /* Z-Index */
    --loki-z-dropdown: ${$.dropdown};
    --loki-z-sticky: ${$.sticky};
    --loki-z-modal: ${$.modal};
    --loki-z-popover: ${$.popover};
    --loki-z-tooltip: ${$.tooltip};
    --loki-z-toast: ${$.toast};

    /* Glass effect */
    --loki-glass-bg: rgba(255, 255, 255, 0.03);
    --loki-glass-border: rgba(255, 255, 255, 0.06);
    --loki-glass-blur: blur(12px);
  `}var R=`
  /* Reset and base */
  :host {
    font-family: var(--loki-font-sans);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    box-sizing: border-box;
    color: var(--loki-text-primary);
  }

  :host *, :host *::before, :host *::after {
    box-sizing: border-box;
  }

  /* Monospace utility */
  .mono {
    font-family: var(--loki-font-mono);
  }

  /* Focus visible outline */
  :focus-visible {
    outline: 2px solid var(--loki-border-focus);
    outline-offset: 2px;
  }

  :focus:not(:focus-visible) {
    outline: none;
  }

  /* Button base */
  .btn {
    padding: var(--loki-space-sm) var(--loki-space-md);
    border-radius: var(--loki-radius-md);
    font-size: var(--loki-text-md);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--loki-transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--loki-space-xs);
    border: 1px solid transparent;
    text-decoration: none;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .btn-primary {
    background: var(--loki-accent);
    color: var(--loki-text-inverse);
  }

  .btn-primary:hover:not(:disabled) {
    background: var(--loki-accent-hover);
  }

  .btn-primary:active:not(:disabled) {
    background: var(--loki-accent-active);
  }

  .btn-secondary {
    background: var(--loki-bg-tertiary);
    color: var(--loki-text-primary);
    border-color: var(--loki-border);
  }

  .btn-secondary:hover:not(:disabled) {
    background: var(--loki-bg-hover);
    border-color: var(--loki-border-light);
  }

  .btn-ghost {
    background: transparent;
    color: var(--loki-text-secondary);
  }

  .btn-ghost:hover:not(:disabled) {
    background: var(--loki-bg-hover);
    color: var(--loki-text-primary);
  }

  .btn-danger {
    background: var(--loki-error);
    color: var(--loki-text-inverse);
  }

  .btn-danger:hover:not(:disabled) {
    background: var(--loki-red);
    filter: brightness(1.1);
  }

  /* Button sizes */
  .btn-sm {
    padding: var(--loki-space-xs) var(--loki-space-sm);
    font-size: var(--loki-text-sm);
  }

  .btn-lg {
    padding: var(--loki-space-md) var(--loki-space-lg);
    font-size: var(--loki-text-lg);
  }

  /* Status indicators */
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: var(--loki-radius-full);
    flex-shrink: 0;
  }

  .status-dot.active {
    background: var(--loki-success);
    animation: pulse 2s infinite;
  }
  .status-dot.idle { background: var(--loki-text-muted); }
  .status-dot.paused { background: var(--loki-warning); }
  .status-dot.stopped { background: var(--loki-error); }
  .status-dot.error { background: var(--loki-error); }
  .status-dot.offline { background: var(--loki-text-muted); }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Card base */
  .card {
    background: var(--loki-bg-card);
    border: 1px solid var(--loki-border);
    border-radius: var(--loki-radius-xl);
    padding: var(--loki-space-lg);
    transition: all var(--loki-transition);
  }

  .card:hover {
    border-color: var(--loki-border-light);
  }

  .card-interactive {
    cursor: pointer;
  }

  .card-interactive:hover {
    transform: translateY(-1px);
    box-shadow: var(--loki-shadow-md);
  }

  /* Input base */
  .input {
    width: 100%;
    padding: var(--loki-space-sm) var(--loki-space-md);
    background: var(--loki-bg-tertiary);
    border: 1px solid var(--loki-border);
    border-radius: var(--loki-radius-md);
    font-size: var(--loki-text-base);
    color: var(--loki-text-primary);
    transition: all var(--loki-transition);
  }

  .input::placeholder {
    color: var(--loki-text-muted);
  }

  .input:hover:not(:disabled) {
    border-color: var(--loki-border-light);
  }

  .input:focus {
    outline: none;
    border-color: var(--loki-border-focus);
    box-shadow: var(--loki-shadow-focus);
  }

  .input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Badge */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 2px var(--loki-space-sm);
    border-radius: var(--loki-radius-sm);
    font-size: var(--loki-text-xs);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .badge-success {
    background: var(--loki-success-muted);
    color: var(--loki-success);
  }

  .badge-warning {
    background: var(--loki-warning-muted);
    color: var(--loki-warning);
  }

  .badge-error {
    background: var(--loki-error-muted);
    color: var(--loki-error);
  }

  .badge-info {
    background: var(--loki-info-muted);
    color: var(--loki-info);
  }

  .badge-neutral {
    background: var(--loki-bg-tertiary);
    color: var(--loki-text-secondary);
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: var(--loki-space-xl);
    color: var(--loki-text-muted);
    font-size: var(--loki-text-base);
  }

  /* Loading spinner */
  .spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--loki-border);
    border-top-color: var(--loki-accent);
    border-radius: var(--loki-radius-full);
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: var(--loki-bg-primary);
    border-radius: var(--loki-radius-sm);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--loki-border);
    border-radius: var(--loki-radius-sm);
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--loki-border-light);
  }

  /* Screen reader only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Responsive utilities */
  @media (max-width: ${F.md}) {
    .hide-mobile { display: none !important; }
  }

  @media (min-width: ${F.md}) {
    .hide-desktop { display: none !important; }
  }
`,c=class c{static detectContext(){return typeof acquireVsCodeApi<"u"||document.body.classList.contains("vscode-body")||getComputedStyle(document.documentElement).getPropertyValue("--vscode-editor-background")?"vscode":document.documentElement.dataset.lokiContext==="cli"?"cli":"browser"}static detectVSCodeTheme(){let e=document.body;if(e.classList.contains("vscode-high-contrast"))return"high-contrast";if(e.classList.contains("vscode-dark"))return"dark";if(e.classList.contains("vscode-light"))return"light";let t=getComputedStyle(document.documentElement).getPropertyValue("--vscode-editor-background");if(t){let a=t.match(/\d+/g);if(a)return(parseInt(a[0])*299+parseInt(a[1])*587+parseInt(a[2])*114)/1e3>128?"light":"dark"}return null}static getTheme(){if(c.detectContext()==="vscode"){let a=c.detectVSCodeTheme();return a==="high-contrast"?"high-contrast":a==="dark"?"vscode-dark":"vscode-light"}let t=localStorage.getItem(c.STORAGE_KEY);return t&&b[t]?t:window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}static setTheme(e){if(!b[e]){console.warn(`Unknown theme: ${e}`);return}localStorage.setItem(c.STORAGE_KEY,e),document.documentElement.setAttribute("data-loki-theme",e),window.dispatchEvent(new CustomEvent("loki-theme-change",{detail:{theme:e,context:c.detectContext()}}))}static toggle(){let e=c.getTheme(),t;return e.includes("dark")||e==="high-contrast"?t=e.startsWith("vscode")?"vscode-light":"light":t=e.startsWith("vscode")?"vscode-dark":"dark",c.setTheme(t),t}static getVariables(e=null){let t=e||c.getTheme();return b[t]||b.light}static generateCSS(e=null){let t=e||c.getTheme();return`
      :host {
        ${m(t)}
        ${P()}
      }
      ${R}
    `}static init(){let e=c.getTheme();document.documentElement.setAttribute("data-loki-theme",e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{localStorage.getItem(c.STORAGE_KEY)||c.setTheme(c.getTheme())}),c.detectContext()==="vscode"&&new MutationObserver(()=>{let a=c.getTheme();document.documentElement.setAttribute("data-loki-theme",a),window.dispatchEvent(new CustomEvent("loki-theme-change",{detail:{theme:a,context:"vscode"}}))}).observe(document.body,{attributes:!0,attributeFilter:["class"]})}};k(c,"STORAGE_KEY","loki-theme"),k(c,"CONTEXT_KEY","loki-context");var h=c,C=class{constructor(){this._handlers=new Map,this._enabled=!0}register(e,t){let a=N[e];if(!a){console.warn(`Unknown keyboard action: ${e}`);return}this._handlers.set(e,{shortcut:a,handler:t})}unregister(e){this._handlers.delete(e)}setEnabled(e){this._enabled=e}handleEvent(e){if(!this._enabled)return!1;for(let[t,{shortcut:a,handler:s}]of this._handlers)if(this._matchesShortcut(e,a))return e.preventDefault(),e.stopPropagation(),s(e),!0;return!1}_matchesShortcut(e,t){let a=e.key.toLowerCase(),s=t.modifiers||[];if(a!==t.key.toLowerCase())return!1;let i=s.includes("Ctrl")||s.includes("Meta"),r=s.includes("Shift"),o=s.includes("Alt"),d=(e.ctrlKey||e.metaKey)===i,p=e.shiftKey===r,D=e.altKey===o;return d&&p&&D}attach(e){this._boundHandler||(this._boundHandler=t=>this.handleEvent(t)),e.addEventListener("keydown",this._boundHandler)}detach(e){this._boundHandler&&e.removeEventListener("keydown",this._boundHandler)}};var K={light:{"--loki-bg-primary":"#fafafa","--loki-bg-secondary":"#f4f4f5","--loki-bg-tertiary":"#e4e4e7","--loki-bg-card":"#ffffff","--loki-bg-hover":"#f0f0f3","--loki-accent":"#7c3aed","--loki-accent-light":"#8b5cf6","--loki-accent-muted":"rgba(124, 58, 237, 0.12)","--loki-text-primary":"#18181b","--loki-text-secondary":"#52525b","--loki-text-muted":"#a1a1aa","--loki-border":"#e4e4e7","--loki-border-light":"#d4d4d8","--loki-green":"#16a34a","--loki-green-muted":"rgba(22, 163, 74, 0.12)","--loki-yellow":"#ca8a04","--loki-yellow-muted":"rgba(202, 138, 4, 0.12)","--loki-red":"#dc2626","--loki-red-muted":"rgba(220, 38, 38, 0.12)","--loki-blue":"#2563eb","--loki-blue-muted":"rgba(37, 99, 235, 0.12)","--loki-purple":"#9333ea","--loki-purple-muted":"rgba(147, 51, 234, 0.12)","--loki-opus":"#d97706","--loki-sonnet":"#4f46e5","--loki-haiku":"#059669","--loki-transition":"0.2s cubic-bezier(0.4, 0, 0.2, 1)"},dark:{"--loki-bg-primary":"#09090b","--loki-bg-secondary":"#0c0c0f","--loki-bg-tertiary":"#111114","--loki-bg-card":"#18181b","--loki-bg-hover":"#1f1f23","--loki-accent":"#8b5cf6","--loki-accent-light":"#a78bfa","--loki-accent-muted":"rgba(139, 92, 246, 0.15)","--loki-text-primary":"#fafafa","--loki-text-secondary":"#a1a1aa","--loki-text-muted":"#52525b","--loki-border":"rgba(255, 255, 255, 0.06)","--loki-border-light":"rgba(255, 255, 255, 0.1)","--loki-green":"#22c55e","--loki-green-muted":"rgba(34, 197, 94, 0.15)","--loki-yellow":"#eab308","--loki-yellow-muted":"rgba(234, 179, 8, 0.15)","--loki-red":"#ef4444","--loki-red-muted":"rgba(239, 68, 68, 0.15)","--loki-blue":"#3b82f6","--loki-blue-muted":"rgba(59, 130, 246, 0.15)","--loki-purple":"#a78bfa","--loki-purple-muted":"rgba(167, 139, 250, 0.15)","--loki-opus":"#f59e0b","--loki-sonnet":"#818cf8","--loki-haiku":"#34d399","--loki-transition":"0.2s cubic-bezier(0.4, 0, 0.2, 1)"}},J=`
  :host {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
  }

  :host *, :host *::before, :host *::after {
    box-sizing: border-box;
  }

  .mono {
    font-family: 'JetBrains Mono', monospace;
  }

  /* Button base styles */
  .btn {
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--loki-transition);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border: none;
  }

  .btn-primary {
    background: var(--loki-accent);
    color: white;
  }

  .btn-primary:hover {
    background: var(--loki-accent-light);
  }

  .btn-secondary {
    background: var(--loki-bg-tertiary);
    color: var(--loki-text-primary);
    border: 1px solid var(--loki-border);
  }

  .btn-secondary:hover {
    background: var(--loki-bg-hover);
  }

  /* Status dot */
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .status-dot.active {
    background: var(--loki-green);
    animation: pulse 2s infinite;
  }
  .status-dot.idle { background: var(--loki-text-muted); }
  .status-dot.paused { background: var(--loki-yellow); }
  .status-dot.stopped { background: var(--loki-red); }
  .status-dot.error { background: var(--loki-red); }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Card base */
  .card {
    background: var(--loki-bg-card);
    border: 1px solid var(--loki-border);
    border-radius: 10px;
    padding: 16px;
    transition: all var(--loki-transition);
  }

  .card:hover {
    border-color: var(--loki-border-light);
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 24px;
    color: var(--loki-text-muted);
    font-size: 12px;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--loki-bg-primary); }
  ::-webkit-scrollbar-thumb { background: var(--loki-border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--loki-border-light); }
`,T=class T{static getTheme(){return h.getTheme()}static setTheme(e){h.setTheme(e)}static toggle(){return h.toggle()}static getVariables(e=null){let t=e||T.getTheme();return b[t]||K[t]||K.light}static toCSSString(e=null){let t=e||T.getTheme();if(b[t])return m(t);let a=T.getVariables(t);return Object.entries(a).map(([s,i])=>`${s}: ${i};`).join(`
`)}static applyToElement(e,t=null){let a=T.getVariables(t);for(let[s,i]of Object.entries(a))e.style.setProperty(s,i)}static init(){h.init()}static detectContext(){return h.detectContext()}static getAvailableThemes(){return Object.keys(b)}};k(T,"STORAGE_KEY","loki-theme");var S=T,u=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._theme=S.getTheme(),this._themeChangeHandler=this._onThemeChange.bind(this),this._keyboardHandler=new C}connectedCallback(){window.addEventListener("loki-theme-change",this._themeChangeHandler),this._applyTheme(),this._setupKeyboardHandling(),this.render()}disconnectedCallback(){window.removeEventListener("loki-theme-change",this._themeChangeHandler),this._keyboardHandler.detach(this)}_onThemeChange(e){this._theme=e.detail.theme,this._applyTheme(),this.onThemeChange&&this.onThemeChange(this._theme)}_applyTheme(){S.applyToElement(this.shadowRoot.host,this._theme),this.setAttribute("data-loki-theme",this._theme)}_setupKeyboardHandling(){this._keyboardHandler.attach(this)}registerShortcut(e,t){this._keyboardHandler.register(e,t)}getBaseStyles(){return`
      /* Design tokens */
      :host {
        ${P()}
      }

      /* Dark theme (default) */
      :host {
        ${m("dark")}
      }

      /* Light theme via system preference */
      @media (prefers-color-scheme: light) {
        :host {
          ${m("light")}
        }
      }

      /* Explicit theme attributes */
      :host([theme="dark"]),
      :host([data-loki-theme="dark"]) {
        ${m("dark")}
      }

      :host([theme="light"]),
      :host([data-loki-theme="light"]) {
        ${m("light")}
      }

      :host([theme="high-contrast"]),
      :host([data-loki-theme="high-contrast"]) {
        ${m("high-contrast")}
      }

      :host([theme="vscode-light"]),
      :host([data-loki-theme="vscode-light"]) {
        ${m("vscode-light")}
      }

      :host([theme="vscode-dark"]),
      :host([data-loki-theme="vscode-dark"]) {
        ${m("vscode-dark")}
      }

      /* Reduced motion preference */
      @media (prefers-reduced-motion: reduce) {
        :host *,
        :host *::before,
        :host *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      ${R}
    `}getAriaPattern(e){return q[e]||{}}applyAriaPattern(e,t){let a=this.getAriaPattern(t);for(let[s,i]of Object.entries(a))if(s==="role")e.setAttribute("role",i);else{let r=s.replace(/([A-Z])/g,"-$1").toLowerCase();e.setAttribute(r,i)}}render(){}};var E={realtime:1e3,normal:2e3,background:5e3,offline:1e4},W={vscode:E.normal,browser:E.realtime,cli:E.background},X={baseUrl:typeof window<"u"?window.location.origin:"http://localhost:57374",wsUrl:typeof window<"u"?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`:"ws://localhost:57374/ws",pollInterval:2e3,timeout:1e4,retryAttempts:3,retryDelay:1e3},n={CONNECTED:"api:connected",DISCONNECTED:"api:disconnected",ERROR:"api:error",STATUS_UPDATE:"api:status-update",TASK_CREATED:"api:task-created",TASK_UPDATED:"api:task-updated",TASK_DELETED:"api:task-deleted",PROJECT_CREATED:"api:project-created",PROJECT_UPDATED:"api:project-updated",AGENT_UPDATE:"api:agent-update",LOG_MESSAGE:"api:log-message",MEMORY_UPDATE:"api:memory-update"},_=class _ extends EventTarget{static getInstance(e={}){let t=e.baseUrl||X.baseUrl;return _._instances.has(t)||_._instances.set(t,new _(e)),_._instances.get(t)}static clearInstances(){_._instances.forEach(e=>e.disconnect()),_._instances.clear()}constructor(e={}){super(),this.config={...X,...e},this._ws=null,this._connected=!1,this._pollInterval=null,this._reconnectTimeout=null,this._cache=new Map,this._cacheTimeout=5e3,this._vscodeApi=null,this._context=this._detectContext(),this._currentPollInterval=W[this._context]||E.normal,this._setupAdaptivePolling(),this._setupVSCodeBridge()}_detectContext(){return typeof acquireVsCodeApi<"u"?"vscode":typeof window<"u"&&window.location?"browser":"cli"}get context(){return this._context}static get POLL_INTERVALS(){return E}_setupAdaptivePolling(){typeof document>"u"||document.addEventListener("visibilitychange",()=>{document.hidden?this._setPollInterval(E.background):this._setPollInterval(W[this._context]||E.normal)})}_setPollInterval(e){this._currentPollInterval=e,this._pollInterval&&(this.stopPolling(),this.startPolling(null,e))}setPollMode(e){let t=E[e];t&&this._setPollInterval(t)}_setupVSCodeBridge(){if(!(typeof acquireVsCodeApi>"u")){try{this._vscodeApi=acquireVsCodeApi()}catch{console.warn("VS Code API already acquired or unavailable");return}window.addEventListener("message",e=>{let t=e.data;if(!(!t||!t.type))switch(t.type){case"updateStatus":this._emit(n.STATUS_UPDATE,t.data);break;case"updateTasks":this._emit(n.TASK_UPDATED,t.data);break;case"taskCreated":this._emit(n.TASK_CREATED,t.data);break;case"taskDeleted":this._emit(n.TASK_DELETED,t.data);break;case"projectCreated":this._emit(n.PROJECT_CREATED,t.data);break;case"projectUpdated":this._emit(n.PROJECT_UPDATED,t.data);break;case"agentUpdate":this._emit(n.AGENT_UPDATE,t.data);break;case"logMessage":this._emit(n.LOG_MESSAGE,t.data);break;case"memoryUpdate":this._emit(n.MEMORY_UPDATE,t.data);break;case"connected":this._connected=!0,this._emit(n.CONNECTED,t.data);break;case"disconnected":this._connected=!1,this._emit(n.DISCONNECTED,t.data);break;case"error":this._emit(n.ERROR,t.data);break;case"setPollMode":this.setPollMode(t.data.mode);break;default:this._emit(`api:${t.type}`,t.data)}})}}get isVSCode(){return this._context==="vscode"}postToVSCode(e,t={}){this._vscodeApi&&this._vscodeApi.postMessage({type:e,data:t})}requestRefresh(){this.postToVSCode("requestRefresh")}notifyVSCode(e,t={}){this.postToVSCode("userAction",{action:e,...t})}get baseUrl(){return this.config.baseUrl}set baseUrl(e){this.config.baseUrl=e,this.config.wsUrl=e.replace(/^http/,"ws")+"/ws"}get isConnected(){return this._connected}async connect(){if(!(this._ws&&this._ws.readyState===WebSocket.OPEN))return new Promise((e,t)=>{try{this._ws=new WebSocket(this.config.wsUrl),this._ws.onopen=()=>{this._connected=!0,this._emit(n.CONNECTED),e()},this._ws.onclose=()=>{this._connected=!1,this._emit(n.DISCONNECTED),this._scheduleReconnect()},this._ws.onerror=a=>{this._emit(n.ERROR,{error:a}),t(a)},this._ws.onmessage=a=>{try{let s=JSON.parse(a.data);this._handleMessage(s)}catch(s){console.error("Failed to parse WebSocket message:",s)}}}catch(a){t(a)}})}disconnect(){this._ws&&(this._ws.close(),this._ws=null),this._pollInterval&&(clearInterval(this._pollInterval),this._pollInterval=null),this._reconnectTimeout&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null),this._connected=!1}_scheduleReconnect(){this._reconnectTimeout||(this._reconnectTimeout=setTimeout(()=>{this._reconnectTimeout=null,this.connect().catch(()=>{})},this.config.retryDelay))}_handleMessage(e){let a={connected:n.CONNECTED,status_update:n.STATUS_UPDATE,task_created:n.TASK_CREATED,task_updated:n.TASK_UPDATED,task_deleted:n.TASK_DELETED,task_moved:n.TASK_UPDATED,project_created:n.PROJECT_CREATED,project_updated:n.PROJECT_UPDATED,agent_update:n.AGENT_UPDATE,log:n.LOG_MESSAGE}[e.type]||`api:${e.type}`;this._emit(a,e.data)}_emit(e,t={}){this.dispatchEvent(new CustomEvent(e,{detail:t}))}async _request(e,t={}){let a=`${this.config.baseUrl}${e}`,s=new AbortController,i=setTimeout(()=>s.abort(),this.config.timeout);try{let r=await fetch(a,{...t,signal:s.signal,headers:{"Content-Type":"application/json",...t.headers}});if(clearTimeout(i),!r.ok){let o=await r.json().catch(()=>({detail:r.statusText}));throw new Error(o.detail||`HTTP ${r.status}`)}return r.status===204?null:await r.json()}catch(r){throw clearTimeout(i),r.name==="AbortError"?new Error("Request timeout"):r}}async _get(e,t=!1){if(t&&this._cache.has(e)){let s=this._cache.get(e);if(Date.now()-s.timestamp<this._cacheTimeout)return s.data}let a=await this._request(e);return t&&this._cache.set(e,{data:a,timestamp:Date.now()}),a}async _post(e,t){return this._request(e,{method:"POST",body:JSON.stringify(t)})}async _put(e,t){return this._request(e,{method:"PUT",body:JSON.stringify(t)})}async _delete(e){return this._request(e,{method:"DELETE"})}async getStatus(){return this._get("/api/status")}async healthCheck(){return this._get("/health")}async listProjects(e=null){let t=e?`?status=${e}`:"";return this._get(`/api/projects${t}`)}async getProject(e){return this._get(`/api/projects/${e}`)}async createProject(e){return this._post("/api/projects",e)}async updateProject(e,t){return this._put(`/api/projects/${e}`,t)}async deleteProject(e){return this._delete(`/api/projects/${e}`)}async listTasks(e={}){let t=new URLSearchParams;e.projectId&&t.append("project_id",e.projectId),e.status&&t.append("status",e.status),e.priority&&t.append("priority",e.priority);let a=t.toString()?`?${t}`:"";return this._get(`/api/tasks${a}`)}async getTask(e){return this._get(`/api/tasks/${e}`)}async createTask(e){return this._post("/api/tasks",e)}async updateTask(e,t){return this._put(`/api/tasks/${e}`,t)}async moveTask(e,t,a){return this._post(`/api/tasks/${e}/move`,{status:t,position:a})}async deleteTask(e){return this._delete(`/api/tasks/${e}`)}async getMemorySummary(){return this._get("/api/memory/summary",!0)}async getMemoryIndex(){return this._get("/api/memory/index",!0)}async getMemoryTimeline(){return this._get("/api/memory/timeline")}async listEpisodes(e={}){let t=new URLSearchParams(e).toString();return this._get(`/api/memory/episodes${t?"?"+t:""}`)}async getEpisode(e){return this._get(`/api/memory/episodes/${e}`)}async listPatterns(e={}){let t=new URLSearchParams(e).toString();return this._get(`/api/memory/patterns${t?"?"+t:""}`)}async getPattern(e){return this._get(`/api/memory/patterns/${e}`)}async listSkills(){return this._get("/api/memory/skills")}async getSkill(e){return this._get(`/api/memory/skills/${e}`)}async retrieveMemories(e,t=null,a=5){return this._post("/api/memory/retrieve",{query:e,taskType:t,topK:a})}async consolidateMemory(e=24){return this._post("/api/memory/consolidate",{sinceHours:e})}async getTokenEconomics(){return this._get("/api/memory/economics")}async listRegisteredProjects(e=!1){return this._get(`/api/registry/projects?include_inactive=${e}`)}async registerProject(e,t=null,a=null){return this._post("/api/registry/projects",{path:e,name:t,alias:a})}async discoverProjects(e=3){return this._get(`/api/registry/discover?max_depth=${e}`)}async syncRegistry(){return this._post("/api/registry/sync",{})}async getCrossProjectTasks(e=null){let t=e?`?project_ids=${e.join(",")}`:"";return this._get(`/api/registry/tasks${t}`)}async getLearningMetrics(e={}){let t=new URLSearchParams;e.timeRange&&t.append("timeRange",e.timeRange),e.signalType&&t.append("signalType",e.signalType),e.source&&t.append("source",e.source);let a=t.toString()?`?${t}`:"";return this._get(`/api/learning/metrics${a}`)}async getLearningTrends(e={}){let t=new URLSearchParams;e.timeRange&&t.append("timeRange",e.timeRange),e.signalType&&t.append("signalType",e.signalType),e.source&&t.append("source",e.source);let a=t.toString()?`?${t}`:"";return this._get(`/api/learning/trends${a}`)}async getLearningSignals(e={}){let t=new URLSearchParams;e.timeRange&&t.append("timeRange",e.timeRange),e.signalType&&t.append("signalType",e.signalType),e.source&&t.append("source",e.source),e.limit&&t.append("limit",String(e.limit)),e.offset&&t.append("offset",String(e.offset));let a=t.toString()?`?${t}`:"";return this._get(`/api/learning/signals${a}`)}async getLatestAggregation(){return this._get("/api/learning/aggregation")}async triggerAggregation(e={}){return this._post("/api/learning/aggregate",e)}async getAggregatedPreferences(e=20){return this._get(`/api/learning/preferences?limit=${e}`)}async getAggregatedErrors(e=20){return this._get(`/api/learning/errors?limit=${e}`)}async getAggregatedSuccessPatterns(e=20){return this._get(`/api/learning/success?limit=${e}`)}async getToolEfficiency(e=20){return this._get(`/api/learning/tools?limit=${e}`)}startPolling(e,t=null){if(this._pollInterval)return;this._pollCallback=e;let a=async()=>{try{let i=await this.getStatus();this._connected=!0,this._pollCallback&&this._pollCallback(i),this._emit(n.STATUS_UPDATE,i),this._vscodeApi&&this.postToVSCode("pollSuccess",{timestamp:Date.now()})}catch(i){this._connected=!1,this._emit(n.ERROR,{error:i}),this._vscodeApi&&this.postToVSCode("pollError",{error:i.message})}};a();let s=t||this._currentPollInterval||this.config.pollInterval;this._pollInterval=setInterval(a,s)}stopPolling(){this._pollInterval&&(clearInterval(this._pollInterval),this._pollInterval=null)}};k(_,"_instances",new Map);var L=_;function Z(l={}){return new L(l)}function g(l={}){return L.getInstance(l)}var G="loki-state-change",V={ui:{theme:"light",sidebarCollapsed:!1,activeSection:"kanban",terminalAutoScroll:!0},session:{connected:!1,lastSync:null,mode:"offline",phase:null,iteration:null},localTasks:[],cache:{projects:[],tasks:[],agents:[],memory:null,lastFetch:null},preferences:{pollInterval:2e3,notifications:!0,soundEnabled:!1}},f=class f extends EventTarget{static getInstance(){return f._instance||(f._instance=new f),f._instance}constructor(){super(),this._state=this._loadState(),this._subscribers=new Map,this._batchUpdates=[],this._batchTimeout=null}_loadState(){try{let e=localStorage.getItem(f.STORAGE_KEY);if(e){let t=JSON.parse(e);return this._mergeState(V,t)}}catch(e){console.warn("Failed to load state from localStorage:",e)}return{...V}}_mergeState(e,t){let a={...e};for(let s of Object.keys(t))s in e&&typeof e[s]=="object"&&!Array.isArray(e[s])?a[s]=this._mergeState(e[s],t[s]):a[s]=t[s];return a}_saveState(){try{let e={ui:this._state.ui,localTasks:this._state.localTasks,preferences:this._state.preferences};localStorage.setItem(f.STORAGE_KEY,JSON.stringify(e))}catch(e){console.warn("Failed to save state to localStorage:",e)}}get(e=null){if(!e)return{...this._state};let t=e.split("."),a=this._state;for(let s of t){if(a==null)return;a=a[s]}return a}set(e,t,a=!0){let s=e.split("."),i=s.pop(),r=this._state;for(let d of s)d in r||(r[d]={}),r=r[d];let o=r[i];r[i]=t,a&&this._saveState(),this._notifyChange(e,t,o)}update(e,t=!0){let a=[];for(let[s,i]of Object.entries(e)){let r=this.get(s);this.set(s,i,!1),a.push({path:s,value:i,oldValue:r})}t&&this._saveState();for(let s of a)this._notifyChange(s.path,s.value,s.oldValue)}_notifyChange(e,t,a){this.dispatchEvent(new CustomEvent(G,{detail:{path:e,value:t,oldValue:a}}));let s=this._subscribers.get(e)||[];for(let r of s)try{r(t,a,e)}catch(o){console.error("State subscriber error:",o)}let i=e.split(".");for(;i.length>1;){i.pop();let r=i.join("."),o=this._subscribers.get(r)||[];for(let d of o)try{d(this.get(r),null,r)}catch(p){console.error("State subscriber error:",p)}}}subscribe(e,t){return this._subscribers.has(e)||this._subscribers.set(e,[]),this._subscribers.get(e).push(t),()=>{let a=this._subscribers.get(e),s=a.indexOf(t);s>-1&&a.splice(s,1)}}reset(e=null){if(e){let t=e.split("."),a=V;for(let s of t)a=a?.[s];this.set(e,a)}else this._state={...V},this._saveState(),this.dispatchEvent(new CustomEvent(G,{detail:{path:null,value:this._state,oldValue:null}}))}addLocalTask(e){let t=this.get("localTasks")||[],a={id:`local-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),status:"pending",...e};return this.set("localTasks",[...t,a]),a}updateLocalTask(e,t){let a=this.get("localTasks")||[],s=a.findIndex(r=>r.id===e);if(s===-1)return null;let i={...a[s],...t,updatedAt:new Date().toISOString()};return a[s]=i,this.set("localTasks",[...a]),i}deleteLocalTask(e){let t=this.get("localTasks")||[];this.set("localTasks",t.filter(a=>a.id!==e))}moveLocalTask(e,t,a=null){let i=(this.get("localTasks")||[]).find(r=>r.id===e);return i?this.updateLocalTask(e,{status:t,position:a??i.position}):null}updateSession(e){this.update(Object.fromEntries(Object.entries(e).map(([t,a])=>[`session.${t}`,a])),!1)}updateCache(e){this.update({"cache.projects":e.projects??this.get("cache.projects"),"cache.tasks":e.tasks??this.get("cache.tasks"),"cache.agents":e.agents??this.get("cache.agents"),"cache.memory":e.memory??this.get("cache.memory"),"cache.lastFetch":new Date().toISOString()},!1)}getMergedTasks(){let e=this.get("cache.tasks")||[],a=(this.get("localTasks")||[]).map(s=>({...s,isLocal:!0}));return[...e,...a]}getTasksByStatus(e){return this.getMergedTasks().filter(t=>t.status===e)}};k(f,"STORAGE_KEY","loki-dashboard-state"),k(f,"_instance",null);var I=f;function A(){return I.getInstance()}function Q(l){let e=A();return{get:()=>e.get(l),set:t=>e.set(l,t),subscribe:t=>e.subscribe(l,t)}}var le=[{id:"pending",label:"Pending",status:"pending",color:"var(--loki-text-muted)"},{id:"in_progress",label:"In Progress",status:"in_progress",color:"var(--loki-blue)"},{id:"review",label:"In Review",status:"review",color:"var(--loki-purple)"},{id:"done",label:"Completed",status:"done",color:"var(--loki-green)"}];var M=class extends u{static get observedAttributes(){return["api-url","project-id","theme","readonly"]}constructor(){super(),this._tasks=[],this._loading=!0,this._error=null,this._draggedTask=null,this._api=null,this._state=A()}connectedCallback(){super.connectedCallback(),this._setupApi(),this._loadTasks()}disconnectedCallback(){super.disconnectedCallback(),this._api&&(this._api.removeEventListener(n.TASK_CREATED,this._onTaskEvent),this._api.removeEventListener(n.TASK_UPDATED,this._onTaskEvent),this._api.removeEventListener(n.TASK_DELETED,this._onTaskEvent))}attributeChangedCallback(e,t,a){t!==a&&(e==="api-url"&&this._api&&(this._api.baseUrl=a,this._loadTasks()),e==="project-id"&&this._loadTasks(),e==="theme"&&this._applyTheme())}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e}),this._onTaskEvent=()=>this._loadTasks(),this._api.addEventListener(n.TASK_CREATED,this._onTaskEvent),this._api.addEventListener(n.TASK_UPDATED,this._onTaskEvent),this._api.addEventListener(n.TASK_DELETED,this._onTaskEvent)}async _loadTasks(){this._loading=!0,this._error=null,this.render();try{let e=this.getAttribute("project-id"),t=e?{projectId:parseInt(e)}:{};this._tasks=await this._api.listTasks(t);let a=this._state.get("localTasks")||[];a.length>0&&(this._tasks=[...this._tasks,...a.map(s=>({...s,isLocal:!0}))]),this._state.update({"cache.tasks":this._tasks},!1)}catch(e){this._error=e.message,this._tasks=(this._state.get("localTasks")||[]).map(t=>({...t,isLocal:!0}))}this._loading=!1,this.render()}_getTasksByStatus(e){return this._tasks.filter(t=>t.status?.toLowerCase().replace(/-/g,"_")===e)}_handleDragStart(e,t){this.hasAttribute("readonly")||(this._draggedTask=t,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id.toString()))}_handleDragEnd(e){e.target.classList.remove("dragging"),this._draggedTask=null,this.shadowRoot.querySelectorAll(".kanban-tasks").forEach(t=>{t.classList.remove("drag-over")})}_handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}_handleDragEnter(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}_handleDragLeave(e){e.currentTarget.contains(e.relatedTarget)||e.currentTarget.classList.remove("drag-over")}async _handleDrop(e,t){if(e.preventDefault(),e.currentTarget.classList.remove("drag-over"),!this._draggedTask||this.hasAttribute("readonly"))return;let a=this._draggedTask.id,s=this._tasks.find(r=>r.id===a);if(!s)return;let i=s.status;if(i!==t){s.status=t,this.render();try{s.isLocal?this._state.moveLocalTask(a,t):await this._api.moveTask(a,t,0),this.dispatchEvent(new CustomEvent("task-moved",{detail:{taskId:a,oldStatus:i,newStatus:t}}))}catch(r){s.status=i,this.render(),console.error("Failed to move task:",r)}}}_openAddTaskModal(e="pending"){this.dispatchEvent(new CustomEvent("add-task",{detail:{status:e}}))}_openTaskDetail(e){this.dispatchEvent(new CustomEvent("task-click",{detail:{task:e}}))}render(){let e=`
      <style>
        ${this.getBaseStyles()}

        :host {
          display: block;
        }

        .board-container {
          width: 100%;
        }

        .board-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
        }

        .board-title {
          font-size: 16px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .board-actions {
          display: flex;
          gap: 8px;
        }

        .loading, .error {
          padding: 40px;
          text-align: center;
          color: var(--loki-text-muted);
        }

        .error {
          color: var(--loki-red);
        }

        .kanban-board {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 12px;
          min-height: 350px;
        }

        @media (max-width: 1200px) {
          .kanban-board { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
          .kanban-board { grid-template-columns: 1fr; }
        }

        .kanban-column {
          background: var(--loki-bg-secondary);
          border-radius: 10px;
          padding: 12px;
          display: flex;
          flex-direction: column;
          transition: background var(--loki-transition);
        }

        .kanban-column-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          padding-bottom: 10px;
          border-bottom: 2px solid var(--loki-border);
        }

        .kanban-column[data-status="pending"] .kanban-column-header { border-color: var(--loki-text-muted); }
        .kanban-column[data-status="in_progress"] .kanban-column-header { border-color: var(--loki-blue); }
        .kanban-column[data-status="review"] .kanban-column-header { border-color: var(--loki-purple); }
        .kanban-column[data-status="done"] .kanban-column-header { border-color: var(--loki-green); }

        .kanban-column-title {
          font-size: 13px;
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 6px;
          color: var(--loki-text-primary);
        }

        .kanban-column-count {
          background: var(--loki-bg-tertiary);
          padding: 2px 8px;
          border-radius: 10px;
          font-size: 11px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-text-secondary);
        }

        .kanban-tasks {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 8px;
          min-height: 80px;
          transition: background var(--loki-transition);
          border-radius: 6px;
          padding: 4px;
        }

        .kanban-tasks.drag-over {
          background: var(--loki-bg-hover);
        }

        .task-card {
          background: var(--loki-bg-card);
          border: 1px solid var(--loki-border);
          border-radius: 6px;
          padding: 10px;
          cursor: pointer;
          transition: all var(--loki-transition);
        }

        .task-card:hover {
          border-color: var(--loki-border-light);
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .task-card.draggable {
          cursor: grab;
        }

        .task-card.dragging {
          opacity: 0.5;
          cursor: grabbing;
        }

        .task-card.local {
          border-left: 3px solid var(--loki-accent);
        }

        .task-card-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 6px;
        }

        .task-id {
          font-size: 11px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-accent);
        }

        .task-priority {
          font-size: 9px;
          padding: 2px 5px;
          border-radius: 3px;
          font-weight: 500;
          text-transform: uppercase;
        }

        .task-priority.high, .task-priority.critical {
          background: var(--loki-red-muted);
          color: var(--loki-red);
        }

        .task-priority.medium {
          background: var(--loki-yellow-muted);
          color: var(--loki-yellow);
        }

        .task-priority.low {
          background: var(--loki-green-muted);
          color: var(--loki-green);
        }

        .task-title {
          font-size: 12px;
          font-weight: 500;
          margin-bottom: 6px;
          line-height: 1.4;
          color: var(--loki-text-primary);
        }

        .task-meta {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        .task-type {
          background: var(--loki-bg-tertiary);
          padding: 2px 6px;
          border-radius: 3px;
        }

        .add-task-btn {
          background: transparent;
          border: 1px dashed var(--loki-border);
          border-radius: 6px;
          padding: 10px;
          color: var(--loki-text-muted);
          font-size: 12px;
          cursor: pointer;
          transition: all var(--loki-transition);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          margin-top: 8px;
        }

        .add-task-btn:hover {
          border-color: var(--loki-accent);
          color: var(--loki-accent);
          background: var(--loki-accent-muted);
        }

        .empty-column {
          text-align: center;
          padding: 20px;
          color: var(--loki-text-muted);
          font-size: 12px;
        }

        /* Column icons */
        .column-icon {
          width: 14px;
          height: 14px;
          stroke: currentColor;
          stroke-width: 2;
          fill: none;
        }
      </style>
    `,t=s=>{switch(s){case"pending":return'<circle cx="12" cy="12" r="10"/>';case"in_progress":return'<path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>';case"review":return'<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';case"done":return'<path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>';default:return'<circle cx="12" cy="12" r="10"/>'}},a;if(this._loading)a='<div class="loading">Loading tasks...</div>';else if(this._error&&this._tasks.length===0)a=`<div class="error">Error: ${this._error}</div>`;else{let s=this.hasAttribute("readonly");a=`
        <div class="kanban-board">
          ${le.map(i=>{let r=this._getTasksByStatus(i.status);return`
              <div class="kanban-column" data-status="${i.status}">
                <div class="kanban-column-header">
                  <span class="kanban-column-title">
                    <svg class="column-icon" viewBox="0 0 24 24" style="color: ${i.color}">
                      ${t(i.status)}
                    </svg>
                    ${i.label}
                  </span>
                  <span class="kanban-column-count">${r.length}</span>
                </div>
                <div class="kanban-tasks" data-status="${i.status}">
                  ${r.length===0?'<div class="empty-column">No tasks</div>':""}
                  ${r.map(o=>`
                    <div class="task-card ${!s&&!o.fromServer?"draggable":""} ${o.isLocal?"local":""}"
                         data-task-id="${o.id}"
                         tabindex="0"
                         role="button"
                         aria-label="Task: ${this._escapeHtml(o.title||"Untitled")}, ${o.priority||"medium"} priority"
                         ${!s&&!o.fromServer?'draggable="true"':""}>
                      <div class="task-card-header">
                        <span class="task-id">${o.isLocal?"LOCAL":"#"+o.id}</span>
                        <span class="task-priority ${(o.priority||"medium").toLowerCase()}">${o.priority||"medium"}</span>
                      </div>
                      <div class="task-title">${this._escapeHtml(o.title||"Untitled")}</div>
                      <div class="task-meta">
                        <span class="task-type">${o.type||"task"}</span>
                        ${o.assigned_agent_id?`<span>Agent #${o.assigned_agent_id}</span>`:""}
                      </div>
                    </div>
                  `).join("")}
                </div>
                ${!s&&i.status==="pending"?`
                  <button class="add-task-btn" data-status="${i.status}" aria-label="Add new task to ${i.label}">+ Add Task</button>
                `:""}
              </div>
            `}).join("")}
        </div>
      `}this.shadowRoot.innerHTML=`
      ${e}
      <div class="board-container">
        <div class="board-header">
          <h2 class="board-title">Task Queue</h2>
          <div class="board-actions">
            <button class="btn btn-secondary" id="refresh-btn" aria-label="Refresh task board">
              <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
              </svg>
              Refresh
            </button>
          </div>
        </div>
        ${a}
      </div>
    `,this._attachEventListeners()}_attachEventListeners(){let e=this.shadowRoot.getElementById("refresh-btn");e&&e.addEventListener("click",()=>this._loadTasks()),this.shadowRoot.querySelectorAll(".add-task-btn").forEach(t=>{t.addEventListener("click",()=>{this._openAddTaskModal(t.dataset.status)})}),this.shadowRoot.querySelectorAll(".task-card").forEach(t=>{let a=t.dataset.taskId,s=this._tasks.find(i=>i.id.toString()===a);s&&(t.addEventListener("click",()=>this._openTaskDetail(s)),t.addEventListener("keydown",i=>{i.key==="Enter"||i.key===" "?(i.preventDefault(),this._openTaskDetail(s)):(i.key==="ArrowDown"||i.key==="ArrowUp")&&(i.preventDefault(),this._navigateTaskCards(t,i.key==="ArrowDown"?"next":"prev"))}),t.classList.contains("draggable")&&(t.addEventListener("dragstart",i=>this._handleDragStart(i,s)),t.addEventListener("dragend",i=>this._handleDragEnd(i))))}),this.shadowRoot.querySelectorAll(".kanban-tasks").forEach(t=>{t.addEventListener("dragover",a=>this._handleDragOver(a)),t.addEventListener("dragenter",a=>this._handleDragEnter(a)),t.addEventListener("dragleave",a=>this._handleDragLeave(a)),t.addEventListener("drop",a=>this._handleDrop(a,t.dataset.status))})}_escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}_navigateTaskCards(e,t){let a=Array.from(this.shadowRoot.querySelectorAll(".task-card")),s=a.indexOf(e);if(s===-1)return;let i=t==="next"?s+1:s-1;i>=0&&i<a.length&&a[i].focus()}};customElements.get("loki-task-board")||customElements.define("loki-task-board",M);var z=class extends u{static get observedAttributes(){return["api-url","theme","compact"]}constructor(){super(),this._status={mode:"offline",phase:null,iteration:null,complexity:null,connected:!1,version:null,uptime:0,activeAgents:0,pendingTasks:0},this._api=null,this._state=A(),this._statusUpdateHandler=null,this._connectedHandler=null,this._disconnectedHandler=null}connectedCallback(){super.connectedCallback(),this._setupApi(),this._loadStatus(),this._startPolling()}disconnectedCallback(){super.disconnectedCallback(),this._stopPolling(),this._api&&(this._statusUpdateHandler&&this._api.removeEventListener(n.STATUS_UPDATE,this._statusUpdateHandler),this._connectedHandler&&this._api.removeEventListener(n.CONNECTED,this._connectedHandler),this._disconnectedHandler&&this._api.removeEventListener(n.DISCONNECTED,this._disconnectedHandler))}attributeChangedCallback(e,t,a){t!==a&&(e==="api-url"&&this._api&&(this._api.baseUrl=a,this._loadStatus()),e==="theme"&&this._applyTheme(),e==="compact"&&this.render())}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e}),this._statusUpdateHandler=t=>this._updateFromStatus(t.detail),this._connectedHandler=()=>{this._status.connected=!0,this.render()},this._disconnectedHandler=()=>{this._status.connected=!1,this._status.mode="offline",this.render()},this._api.addEventListener(n.STATUS_UPDATE,this._statusUpdateHandler),this._api.addEventListener(n.CONNECTED,this._connectedHandler),this._api.addEventListener(n.DISCONNECTED,this._disconnectedHandler)}async _loadStatus(){try{let e=await this._api.getStatus();this._updateFromStatus(e)}catch{this._status.connected=!1,this._status.mode="offline",this.render()}}_updateFromStatus(e){e&&(this._status={...this._status,connected:!0,mode:e.status||"running",version:e.version,uptime:e.uptime_seconds||0,activeAgents:e.running_agents||0,pendingTasks:e.pending_tasks||0,phase:e.phase,iteration:e.iteration,complexity:e.complexity},this._state.updateSession({connected:!0,mode:this._status.mode,lastSync:new Date().toISOString()}),this.render())}_startPolling(){this._ownPollInterval=setInterval(async()=>{try{let e=await this._api.getStatus();this._updateFromStatus(e)}catch{this._status.connected=!1,this._status.mode="offline",this.render()}},3e3)}_stopPolling(){this._ownPollInterval&&(clearInterval(this._ownPollInterval),this._ownPollInterval=null)}_formatUptime(e){if(!e||e<0)return"--";let t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?`${t}h ${a}m`:a>0?`${a}m ${s}s`:`${s}s`}_getStatusClass(){switch(this._status.mode){case"running":case"autonomous":return"active";case"paused":return"paused";case"stopped":return"stopped";case"error":return"error";default:return"offline"}}_getStatusLabel(){switch(this._status.mode){case"running":case"autonomous":return"AUTONOMOUS";case"paused":return"PAUSED";case"stopped":return"STOPPED";case"error":return"ERROR";default:return"OFFLINE"}}_triggerStart(){this.dispatchEvent(new CustomEvent("session-start",{detail:this._status}))}_triggerPause(){this.dispatchEvent(new CustomEvent("session-pause",{detail:this._status}))}_triggerResume(){this.dispatchEvent(new CustomEvent("session-resume",{detail:this._status}))}_triggerStop(){this.dispatchEvent(new CustomEvent("session-stop",{detail:this._status}))}render(){let e=this.hasAttribute("compact"),t=this._getStatusClass(),a=this._getStatusLabel(),s=["running","autonomous"].includes(this._status.mode),i=this._status.mode==="paused",r=`
      <style>
        ${this.getBaseStyles()}

        :host {
          display: block;
        }

        .control-panel {
          background: var(--loki-bg-tertiary);
          border-radius: 10px;
          padding: 14px;
          display: flex;
          flex-direction: column;
          gap: 10px;
          transition: background var(--loki-transition);
        }

        .control-panel.compact {
          padding: 10px;
          gap: 8px;
        }

        .panel-title {
          font-size: 10px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          color: var(--loki-text-muted);
          margin-bottom: 4px;
        }

        .status-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 12px;
        }

        .status-label {
          color: var(--loki-text-secondary);
        }

        .status-value {
          font-weight: 500;
          display: flex;
          align-items: center;
          gap: 6px;
          color: var(--loki-text-primary);
        }

        .status-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
        }

        .status-dot.active {
          background: var(--loki-green);
          animation: pulse 2s infinite;
        }
        .status-dot.idle { background: var(--loki-text-muted); }
        .status-dot.paused { background: var(--loki-yellow); }
        .status-dot.stopped { background: var(--loki-red); }
        .status-dot.error { background: var(--loki-red); }
        .status-dot.offline { background: var(--loki-text-muted); }

        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }

        .control-buttons {
          display: flex;
          gap: 6px;
          margin-top: 6px;
        }

        .control-btn {
          flex: 1;
          padding: 6px 10px;
          border-radius: 6px;
          border: 1px solid var(--loki-border);
          background: var(--loki-bg-card);
          color: var(--loki-text-secondary);
          font-size: 11px;
          font-weight: 500;
          cursor: pointer;
          transition: all var(--loki-transition);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 4px;
        }

        .control-btn:hover {
          background: var(--loki-bg-hover);
          color: var(--loki-text-primary);
        }

        .control-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .control-btn.start:hover:not(:disabled) {
          background: var(--loki-green-muted);
          color: var(--loki-green);
          border-color: var(--loki-green);
        }

        .control-btn.pause:hover:not(:disabled) {
          background: var(--loki-yellow-muted);
          color: var(--loki-yellow);
          border-color: var(--loki-yellow);
        }

        .control-btn.resume:hover:not(:disabled) {
          background: var(--loki-green-muted);
          color: var(--loki-green);
          border-color: var(--loki-green);
        }

        .control-btn.stop:hover:not(:disabled) {
          background: var(--loki-red-muted);
          color: var(--loki-red);
          border-color: var(--loki-red);
        }

        .control-btn svg {
          width: 10px;
          height: 10px;
          fill: currentColor;
        }

        .connection-status {
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          background: var(--loki-bg-tertiary);
          border-radius: 6px;
          font-size: 11px;
          color: var(--loki-text-muted);
          margin-top: 4px;
        }

        .connection-dot {
          width: 6px;
          height: 6px;
          border-radius: 50%;
          background: var(--loki-red);
        }

        .connection-dot.connected {
          background: var(--loki-green);
          animation: pulse 2s infinite;
        }

        .stats-row {
          display: flex;
          justify-content: space-around;
          padding: 8px 0;
          border-top: 1px solid var(--loki-border);
          margin-top: 4px;
        }

        .stat-item {
          text-align: center;
        }

        .stat-value {
          font-size: 16px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-text-primary);
        }

        .stat-label {
          font-size: 10px;
          color: var(--loki-text-muted);
        }
      </style>
    `,o=`
      <div class="control-panel compact">
        <div class="status-row">
          <span class="status-value">
            <span class="status-dot ${t}"></span>
            ${a}
          </span>
        </div>
        <div class="control-buttons" role="group" aria-label="Session controls">
          ${i?`
            <button class="control-btn resume" id="resume-btn" aria-label="Resume session">
              <svg viewBox="0 0 24 24" aria-hidden="true"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              Resume
            </button>
          `:`
            <button class="control-btn pause" id="pause-btn" aria-label="Pause session" ${s?"":"disabled"}>
              <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              Pause
            </button>
          `}
          <button class="control-btn stop" id="stop-btn" aria-label="Stop session" ${!s&&!i?"disabled":""}>
            <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
            Stop
          </button>
        </div>
      </div>
    `,d=`
      <div class="control-panel">
        <div class="panel-title">System Status</div>

        <div class="status-row">
          <span class="status-label">Mode</span>
          <span class="status-value">
            <span class="status-dot ${t}"></span>
            ${a}
          </span>
        </div>

        <div class="status-row">
          <span class="status-label">Phase</span>
          <span class="status-value">${this._status.phase||"--"}</span>
        </div>

        <div class="status-row">
          <span class="status-label">Complexity</span>
          <span class="status-value">${String(this._status.complexity||"--").toUpperCase()}</span>
        </div>

        <div class="status-row">
          <span class="status-label">Iteration</span>
          <span class="status-value">${this._status.iteration||"--"}</span>
        </div>

        <div class="status-row">
          <span class="status-label">Uptime</span>
          <span class="status-value">${this._formatUptime(this._status.uptime)}</span>
        </div>

        <div class="control-buttons" role="group" aria-label="Session controls">
          ${i?`
            <button class="control-btn resume" id="resume-btn" aria-label="Resume session">
              <svg viewBox="0 0 24 24" aria-hidden="true"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              Resume
            </button>
          `:`
            <button class="control-btn pause" id="pause-btn" aria-label="Pause session" ${s?"":"disabled"}>
              <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              Pause
            </button>
          `}
          <button class="control-btn stop" id="stop-btn" aria-label="Stop session" ${!s&&!i?"disabled":""}>
            <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
            Stop
          </button>
        </div>

        <div class="connection-status">
          <span class="connection-dot ${this._status.connected?"connected":""}"></span>
          <span>${this._status.connected?"Connected":"Disconnected"}</span>
          ${this._status.version?`<span style="margin-left: auto">v${this._status.version}</span>`:""}
        </div>

        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value">${this._status.activeAgents}</div>
            <div class="stat-label">Agents</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${this._status.pendingTasks}</div>
            <div class="stat-label">Pending</div>
          </div>
        </div>
      </div>
    `;this.shadowRoot.innerHTML=`
      ${r}
      ${e?o:d}
    `,this._attachEventListeners()}_attachEventListeners(){let e=this.shadowRoot.getElementById("pause-btn"),t=this.shadowRoot.getElementById("resume-btn"),a=this.shadowRoot.getElementById("stop-btn"),s=this.shadowRoot.getElementById("start-btn");e&&e.addEventListener("click",()=>this._triggerPause()),t&&t.addEventListener("click",()=>this._triggerResume()),a&&a.addEventListener("click",()=>this._triggerStop()),s&&s.addEventListener("click",()=>this._triggerStart())}};customElements.get("loki-session-control")||customElements.define("loki-session-control",z);var ee={info:{color:"var(--loki-blue)",label:"INFO"},success:{color:"var(--loki-green)",label:"SUCCESS"},warning:{color:"var(--loki-yellow)",label:"WARN"},error:{color:"var(--loki-red)",label:"ERROR"},step:{color:"var(--loki-purple)",label:"STEP"},agent:{color:"var(--loki-accent)",label:"AGENT"},debug:{color:"var(--loki-text-muted)",label:"DEBUG"}},j=class extends u{static get observedAttributes(){return["api-url","max-lines","auto-scroll","theme","log-file"]}constructor(){super(),this._logs=[],this._maxLines=500,this._autoScroll=!0,this._filter="",this._levelFilter="all",this._api=null,this._pollInterval=null}connectedCallback(){super.connectedCallback(),this._maxLines=parseInt(this.getAttribute("max-lines"))||500,this._autoScroll=this.hasAttribute("auto-scroll"),this._setupApi(),this._startLogPolling()}disconnectedCallback(){super.disconnectedCallback(),this._stopLogPolling()}attributeChangedCallback(e,t,a){if(t!==a)switch(e){case"api-url":this._api&&(this._api.baseUrl=a);break;case"max-lines":this._maxLines=parseInt(a)||500,this._trimLogs(),this.render();break;case"auto-scroll":this._autoScroll=this.hasAttribute("auto-scroll"),this.render();break;case"theme":this._applyTheme();break}}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e}),this._api.addEventListener(n.LOG_MESSAGE,t=>{this._addLog(t.detail)})}_startLogPolling(){let e=this.getAttribute("log-file");e&&this._pollLogFile(e)}async _pollLogFile(e){let t=0,a=async()=>{try{let s=await fetch(`${e}?t=${Date.now()}`);if(!s.ok)return;let r=(await s.text()).split(`
`);if(r.length>t){let o=r.slice(t);for(let d of o)d.trim()&&this._addLog(this._parseLine(d));t=r.length}}catch{}};a(),this._pollInterval=setInterval(a,1e3)}_stopLogPolling(){this._pollInterval&&(clearInterval(this._pollInterval),this._pollInterval=null)}_parseLine(e){let t=e.match(/^\[([^\]]+)\]\s*\[([^\]]+)\]\s*(.+)$/);if(t)return{timestamp:t[1],level:t[2].toLowerCase(),message:t[3]};let a=e.match(/^(\d{2}:\d{2}:\d{2})\s+(\w+)\s+(.+)$/);return a?{timestamp:a[1],level:a[2].toLowerCase(),message:a[3]}:{timestamp:new Date().toLocaleTimeString(),level:"info",message:e}}_addLog(e){if(!e)return;let t={id:Date.now()+Math.random(),timestamp:e.timestamp||new Date().toLocaleTimeString(),level:(e.level||"info").toLowerCase(),message:e.message||e};this._logs.push(t),this._trimLogs(),this.dispatchEvent(new CustomEvent("log-received",{detail:t})),this._renderLogs(),this._autoScroll&&this._scrollToBottom()}_trimLogs(){this._logs.length>this._maxLines&&(this._logs=this._logs.slice(-this._maxLines))}_clearLogs(){this._logs=[],this.dispatchEvent(new CustomEvent("logs-cleared")),this._renderLogs()}_toggleAutoScroll(){this._autoScroll=!this._autoScroll,this.render(),this._autoScroll&&this._scrollToBottom()}_scrollToBottom(){requestAnimationFrame(()=>{let e=this.shadowRoot.getElementById("log-output");e&&(e.scrollTop=e.scrollHeight)})}_downloadLogs(){let e=this._logs.map(i=>`[${i.timestamp}] [${i.level.toUpperCase()}] ${i.message}`).join(`
`),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`loki-logs-${new Date().toISOString().split("T")[0]}.txt`,s.click(),URL.revokeObjectURL(a)}_setFilter(e){this._filter=e.toLowerCase(),this._renderLogs()}_setLevelFilter(e){this._levelFilter=e,this._renderLogs()}_getFilteredLogs(){return this._logs.filter(e=>!(this._levelFilter!=="all"&&e.level!==this._levelFilter||this._filter&&!e.message.toLowerCase().includes(this._filter)))}_renderLogs(){let e=this.shadowRoot.getElementById("log-output");if(!e)return;let t=this._getFilteredLogs();if(t.length===0){e.innerHTML='<div class="log-empty">No log output yet. Terminal will update when Loki Mode is running.</div>';return}e.innerHTML=t.map(a=>{let s=ee[a.level]||ee.info;return`
        <div class="log-line">
          <span class="timestamp">${this._escapeHtml(a.timestamp)}</span>
          <span class="level" style="color: ${s.color}">[${this._escapeHtml(s.label)}]</span>
          <span class="message">${this._escapeHtml(a.message)}</span>
        </div>
      `}).join(""),this._autoScroll&&this._scrollToBottom()}_escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}render(){let e=`
      <style>
        ${this.getBaseStyles()}

        :host {
          display: block;
        }

        .terminal-container {
          background: var(--loki-bg-secondary);
          border: 1px solid var(--loki-border);
          border-radius: 10px;
          overflow: hidden;
        }

        .terminal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 14px;
          background: var(--loki-bg-tertiary);
          border-bottom: 1px solid var(--loki-border);
        }

        .terminal-title {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 12px;
          font-weight: 600;
          color: var(--loki-text-secondary);
        }

        .terminal-dots {
          display: flex;
          gap: 6px;
        }

        .terminal-dot {
          width: 10px;
          height: 10px;
          border-radius: 50%;
        }

        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27c93f; }

        .terminal-controls {
          display: flex;
          gap: 8px;
          align-items: center;
        }

        .terminal-btn {
          padding: 4px 10px;
          background: var(--loki-bg-hover);
          border: 1px solid var(--loki-border-light);
          border-radius: 4px;
          color: var(--loki-text-secondary);
          font-size: 11px;
          cursor: pointer;
          transition: all var(--loki-transition);
        }

        .terminal-btn:hover {
          background: var(--loki-border-light);
          color: var(--loki-text-primary);
        }

        .terminal-btn.active {
          background: var(--loki-accent);
          border-color: var(--loki-accent);
          color: white;
        }

        .filter-input {
          padding: 4px 10px;
          background: var(--loki-bg-hover);
          border: 1px solid var(--loki-border-light);
          border-radius: 4px;
          color: var(--loki-text-primary);
          font-size: 11px;
          width: 120px;
        }

        .filter-input:focus {
          outline: none;
          border-color: var(--loki-accent);
        }

        .filter-input::placeholder {
          color: var(--loki-text-muted);
        }

        .level-select {
          padding: 4px 10px;
          background: var(--loki-bg-hover);
          border: 1px solid var(--loki-border-light);
          border-radius: 4px;
          color: var(--loki-text-secondary);
          font-size: 11px;
          cursor: pointer;
        }

        .log-output {
          padding: 14px;
          max-height: 350px;
          overflow-y: auto;
          font-family: 'JetBrains Mono', monospace;
          font-size: 12px;
          line-height: 1.6;
          color: var(--loki-text-primary);
          background: var(--loki-bg-secondary);
        }

        .log-line {
          display: flex;
          gap: 10px;
          white-space: pre-wrap;
          word-break: break-all;
        }

        .log-line .timestamp {
          color: var(--loki-text-muted);
          flex-shrink: 0;
        }

        .log-line .level {
          flex-shrink: 0;
          font-weight: 500;
        }

        .log-line .message {
          flex: 1;
        }

        .log-empty {
          color: var(--loki-text-muted);
          text-align: center;
          padding: 40px;
        }

        .log-count {
          font-size: 10px;
          color: var(--loki-text-muted);
          padding: 4px 14px;
          border-top: 1px solid var(--loki-border);
          background: var(--loki-bg-secondary);
        }

        /* Scrollbar */
        .log-output::-webkit-scrollbar { width: 6px; }
        .log-output::-webkit-scrollbar-track { background: var(--loki-bg-secondary); }
        .log-output::-webkit-scrollbar-thumb { background: var(--loki-border-light); border-radius: 3px; }
        .log-output::-webkit-scrollbar-thumb:hover { background: var(--loki-text-muted); }
      </style>
    `;this.shadowRoot.innerHTML=`
      ${e}
      <div class="terminal-container">
        <div class="terminal-header">
          <div class="terminal-title">
            <div class="terminal-dots">
              <span class="terminal-dot red"></span>
              <span class="terminal-dot yellow"></span>
              <span class="terminal-dot green"></span>
            </div>
            loki-mode -- agent output
          </div>
          <div class="terminal-controls">
            <input type="text" class="filter-input" id="filter-input" placeholder="Filter logs...">
            <select class="level-select" id="level-select">
              <option value="all">All Levels</option>
              <option value="info">Info</option>
              <option value="success">Success</option>
              <option value="warning">Warning</option>
              <option value="error">Error</option>
              <option value="step">Step</option>
              <option value="agent">Agent</option>
              <option value="debug">Debug</option>
            </select>
            <button class="terminal-btn ${this._autoScroll?"active":""}" id="auto-scroll-btn" aria-label="Toggle auto-scroll" aria-pressed="${this._autoScroll}">Auto-scroll</button>
            <button class="terminal-btn" id="clear-btn" aria-label="Clear all logs">Clear</button>
            <button class="terminal-btn" id="download-btn" aria-label="Download logs as text file">Download</button>
          </div>
        </div>
        <div class="log-output" id="log-output" role="log" aria-live="polite" aria-label="Log output">
          <div class="log-empty">No log output yet. Terminal will update when Loki Mode is running.</div>
        </div>
        <div class="log-count">
          ${this._logs.length} lines (${this._getFilteredLogs().length} shown)
        </div>
      </div>
    `,this._attachEventListeners(),this._renderLogs()}_attachEventListeners(){let e=this.shadowRoot.getElementById("filter-input"),t=this.shadowRoot.getElementById("level-select"),a=this.shadowRoot.getElementById("auto-scroll-btn"),s=this.shadowRoot.getElementById("clear-btn"),i=this.shadowRoot.getElementById("download-btn");e&&(e.value=this._filter,e.addEventListener("input",r=>this._setFilter(r.target.value))),t&&(t.value=this._levelFilter,t.addEventListener("change",r=>this._setLevelFilter(r.target.value))),a&&a.addEventListener("click",()=>this._toggleAutoScroll()),s&&s.addEventListener("click",()=>this._clearLogs()),i&&i.addEventListener("click",()=>this._downloadLogs())}addLog(e,t="info"){this._addLog({message:e,level:t,timestamp:new Date().toLocaleTimeString()})}clear(){this._clearLogs()}};customElements.get("loki-log-stream")||customElements.define("loki-log-stream",j);var de=[{id:"summary",label:"Summary",icon:"M4 6h16M4 12h16M4 18h16"},{id:"episodes",label:"Episodes",icon:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},{id:"patterns",label:"Patterns",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},{id:"skills",label:"Skills",icon:"M13 10V3L4 14h7v7l9-11h-7z"}],B=class extends u{static get observedAttributes(){return["api-url","theme","tab"]}constructor(){super(),this._activeTab="summary",this._loading=!1,this._error=null,this._api=null,this._summary=null,this._episodes=[],this._patterns=[],this._skills=[],this._tokenEconomics=null,this._selectedItem=null,this._lastFocusedElement=null}connectedCallback(){super.connectedCallback(),this._activeTab=this.getAttribute("tab")||"summary",this._setupApi(),this._loadData()}attributeChangedCallback(e,t,a){if(t!==a)switch(e){case"api-url":this._api&&(this._api.baseUrl=a,this._loadData());break;case"theme":this._applyTheme();break;case"tab":this._setTab(a);break}}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e})}async _loadData(){this._loading=!0,this._error=null,this.render();try{this._summary=await this._api.getMemorySummary().catch(()=>null),this._tokenEconomics=await this._api.getTokenEconomics().catch(()=>null),await this._loadTabData()}catch(e){this._error=e.message||"Failed to load memory data"}this._loading=!1,this.render()}async _loadTabData(){switch(this._activeTab){case"episodes":this._episodes=await this._api.listEpisodes({limit:50}).catch(()=>[]);break;case"patterns":this._patterns=await this._api.listPatterns().catch(()=>[]);break;case"skills":this._skills=await this._api.listSkills().catch(()=>[]);break}}_setTab(e){this._activeTab!==e&&(this._activeTab=e,this._selectedItem=null,this._loadTabData().then(()=>this.render()))}async _selectEpisode(e){try{this._lastFocusedElement=this.shadowRoot.activeElement,this._selectedItem=await this._api.getEpisode(e),this.dispatchEvent(new CustomEvent("episode-select",{detail:this._selectedItem})),this.render(),this._focusDetailPanel()}catch(t){console.error("Failed to load episode:",t)}}async _selectPattern(e){try{this._lastFocusedElement=this.shadowRoot.activeElement,this._selectedItem=await this._api.getPattern(e),this.dispatchEvent(new CustomEvent("pattern-select",{detail:this._selectedItem})),this.render(),this._focusDetailPanel()}catch(t){console.error("Failed to load pattern:",t)}}async _selectSkill(e){try{this._lastFocusedElement=this.shadowRoot.activeElement,this._selectedItem=await this._api.getSkill(e),this.dispatchEvent(new CustomEvent("skill-select",{detail:this._selectedItem})),this.render(),this._focusDetailPanel()}catch(t){console.error("Failed to load skill:",t)}}_focusDetailPanel(){requestAnimationFrame(()=>{let e=this.shadowRoot.getElementById("close-detail");e&&e.focus()})}_closeDetail(){this._selectedItem=null,this.render(),this._lastFocusedElement&&requestAnimationFrame(()=>{this._lastFocusedElement.focus(),this._lastFocusedElement=null})}async _triggerConsolidation(){try{let e=await this._api.consolidateMemory(24);alert(`Consolidation complete:
- Patterns created: ${e.patternsCreated}
- Patterns merged: ${e.patternsMerged}
- Episodes processed: ${e.episodesProcessed}`),this._loadData()}catch(e){alert("Consolidation failed: "+e.message)}}_renderSummary(){if(!this._summary)return'<div class="empty-state">No memory data available</div>';let{episodic:e,semantic:t,procedural:a,tokenEconomics:s}=this._summary;return`
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Episodic Memory</span>
            <span class="summary-card-count">${e?.count||0}</span>
          </div>
          <div class="summary-card-detail">
            Specific interaction traces and outcomes
          </div>
          ${e?.latestDate?`<div class="summary-card-meta">Latest: ${new Date(e.latestDate).toLocaleDateString()}</div>`:""}
          <div class="memory-bar">
            <div class="memory-bar-fill episodic" style="width: ${Math.min((e?.count||0)/100*100,100)}%"></div>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Semantic Memory</span>
            <span class="summary-card-count">${t?.patterns||0}</span>
          </div>
          <div class="summary-card-detail">
            Generalized patterns and anti-patterns
          </div>
          <div class="summary-card-meta">Anti-patterns: ${t?.antiPatterns||0}</div>
          <div class="memory-bar">
            <div class="memory-bar-fill semantic" style="width: ${Math.min((t?.patterns||0)/100*100,100)}%"></div>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Procedural Memory</span>
            <span class="summary-card-count">${a?.skills||0}</span>
          </div>
          <div class="summary-card-detail">
            Learned skills and procedures
          </div>
          <div class="memory-bar">
            <div class="memory-bar-fill procedural" style="width: ${Math.min((a?.skills||0)/100*100,100)}%"></div>
          </div>
        </div>

        ${this._tokenEconomics?`
          <div class="summary-card token-economics">
            <div class="summary-card-header">
              <span class="summary-card-title">Token Economics</span>
            </div>
            <div class="economics-stats">
              <div class="econ-stat">
                <span class="econ-label">Discovery</span>
                <span class="econ-value">${this._tokenEconomics.discoveryTokens?.toLocaleString()||0}</span>
              </div>
              <div class="econ-stat">
                <span class="econ-label">Read</span>
                <span class="econ-value">${this._tokenEconomics.readTokens?.toLocaleString()||0}</span>
              </div>
              <div class="econ-stat">
                <span class="econ-label">Savings</span>
                <span class="econ-value savings">${(this._tokenEconomics.savingsPercent||0).toFixed(1)}%</span>
              </div>
            </div>
          </div>
        `:""}
      </div>

      <div class="summary-actions">
        <button class="btn btn-secondary" id="consolidate-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
            <polyline points="23 4 23 10 17 10"/>
            <polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
          </svg>
          Consolidate Memory
        </button>
        <button class="btn btn-secondary" id="refresh-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
            <polyline points="23 4 23 10 17 10"/>
            <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
          </svg>
          Refresh
        </button>
      </div>
    `}_renderEpisodes(){return this._episodes.length===0?'<div class="empty-state">No episodes recorded yet</div>':`
      <div class="item-list" role="list" aria-label="Episodes list">
        ${this._episodes.map(e=>`
          <div class="item-card" data-id="${e.id}" data-type="episode" tabindex="0" role="listitem" aria-label="Episode ${e.id}: ${this._escapeHtml(e.taskId||"Task")}, outcome ${e.outcome||"unknown"}">
            <div class="item-header">
              <span class="item-id mono">${e.id}</span>
              <span class="item-outcome ${e.outcome?.toLowerCase()}">${e.outcome||"unknown"}</span>
            </div>
            <div class="item-title">${this._escapeHtml(e.taskId||"Task")}</div>
            <div class="item-meta">
              <span>${e.agent||"unknown agent"}</span>
              <span>${e.phase||"unknown phase"}</span>
              <span>${new Date(e.timestamp).toLocaleString()}</span>
            </div>
          </div>
        `).join("")}
      </div>
    `}_renderPatterns(){return this._patterns.length===0?'<div class="empty-state">No patterns discovered yet</div>':`
      <div class="item-list" role="list" aria-label="Patterns list">
        ${this._patterns.map(e=>`
          <div class="item-card" data-id="${e.id}" data-type="pattern" tabindex="0" role="listitem" aria-label="Pattern: ${this._escapeHtml(e.pattern)}, ${(e.confidence*100).toFixed(0)} percent confidence">
            <div class="item-header">
              <span class="item-category">${e.category||"general"}</span>
              <span class="confidence-badge">${(e.confidence*100).toFixed(0)}%</span>
            </div>
            <div class="item-title">${this._escapeHtml(e.pattern)}</div>
            <div class="item-meta">
              <span>Used ${e.usageCount||0} times</span>
            </div>
          </div>
        `).join("")}
      </div>
    `}_renderSkills(){return this._skills.length===0?'<div class="empty-state">No skills learned yet</div>':`
      <div class="item-list" role="list" aria-label="Skills list">
        ${this._skills.map(e=>`
          <div class="item-card" data-id="${e.id}" data-type="skill" tabindex="0" role="listitem" aria-label="Skill: ${this._escapeHtml(e.name)}">
            <div class="item-header">
              <span class="item-id mono">${e.id}</span>
            </div>
            <div class="item-title">${this._escapeHtml(e.name)}</div>
            <div class="item-description">${this._escapeHtml(e.description||"")}</div>
          </div>
        `).join("")}
      </div>
    `}_renderDetail(){if(!this._selectedItem)return"";let e=this._selectedItem;return e.actionLog!==void 0?`
        <div class="detail-panel">
          <div class="detail-header">
            <h3>Episode: ${e.id}</h3>
            <button class="close-btn" id="close-detail">&times;</button>
          </div>
          <div class="detail-body">
            <div class="detail-row">
              <span class="detail-label">Task</span>
              <span class="detail-value">${e.taskId||"--"}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Agent</span>
              <span class="detail-value">${e.agent||"--"}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Phase</span>
              <span class="detail-value">${e.phase||"--"}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Outcome</span>
              <span class="detail-value outcome ${e.outcome?.toLowerCase()}">${e.outcome||"--"}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Duration</span>
              <span class="detail-value">${e.durationSeconds||0}s</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Tokens Used</span>
              <span class="detail-value">${e.tokensUsed?.toLocaleString()||0}</span>
            </div>
            ${e.goal?`
              <div class="detail-section">
                <div class="detail-label">Goal</div>
                <div class="detail-content">${this._escapeHtml(e.goal)}</div>
              </div>
            `:""}
            ${e.actionLog?.length?`
              <div class="detail-section">
                <div class="detail-label">Action Log (${e.actionLog.length})</div>
                <div class="action-log">
                  ${e.actionLog.map(t=>`
                    <div class="action-entry">
                      <span class="action-time">+${t.t}s</span>
                      <span class="action-type">${t.action}</span>
                      <span class="action-target">${this._escapeHtml(t.target)}</span>
                    </div>
                  `).join("")}
                </div>
              </div>
            `:""}
          </div>
        </div>
      `:e.conditions!==void 0?`
        <div class="detail-panel">
          <div class="detail-header">
            <h3>Pattern: ${e.id}</h3>
            <button class="close-btn" id="close-detail">&times;</button>
          </div>
          <div class="detail-body">
            <div class="detail-row">
              <span class="detail-label">Category</span>
              <span class="detail-value">${e.category||"general"}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Confidence</span>
              <span class="detail-value">${(e.confidence*100).toFixed(0)}%</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Usage Count</span>
              <span class="detail-value">${e.usageCount||0}</span>
            </div>
            <div class="detail-section">
              <div class="detail-label">Pattern</div>
              <div class="detail-content">${this._escapeHtml(e.pattern)}</div>
            </div>
            ${e.conditions?.length?`
              <div class="detail-section">
                <div class="detail-label">Conditions</div>
                <ul class="detail-list">
                  ${e.conditions.map(t=>`<li>${this._escapeHtml(t)}</li>`).join("")}
                </ul>
              </div>
            `:""}
            ${e.correctApproach?`
              <div class="detail-section">
                <div class="detail-label">Correct Approach</div>
                <div class="detail-content success">${this._escapeHtml(e.correctApproach)}</div>
              </div>
            `:""}
            ${e.incorrectApproach?`
              <div class="detail-section">
                <div class="detail-label">Incorrect Approach</div>
                <div class="detail-content error">${this._escapeHtml(e.incorrectApproach)}</div>
              </div>
            `:""}
          </div>
        </div>
      `:e.steps!==void 0?`
        <div class="detail-panel">
          <div class="detail-header">
            <h3>Skill: ${e.name}</h3>
            <button class="close-btn" id="close-detail">&times;</button>
          </div>
          <div class="detail-body">
            <div class="detail-section">
              <div class="detail-label">Description</div>
              <div class="detail-content">${this._escapeHtml(e.description)}</div>
            </div>
            ${e.prerequisites?.length?`
              <div class="detail-section">
                <div class="detail-label">Prerequisites</div>
                <ul class="detail-list">
                  ${e.prerequisites.map(t=>`<li>${this._escapeHtml(t)}</li>`).join("")}
                </ul>
              </div>
            `:""}
            ${e.steps?.length?`
              <div class="detail-section">
                <div class="detail-label">Steps</div>
                <ol class="detail-list numbered">
                  ${e.steps.map(t=>`<li>${this._escapeHtml(t)}</li>`).join("")}
                </ol>
              </div>
            `:""}
            ${e.exitCriteria?.length?`
              <div class="detail-section">
                <div class="detail-label">Exit Criteria</div>
                <ul class="detail-list">
                  ${e.exitCriteria.map(t=>`<li>${this._escapeHtml(t)}</li>`).join("")}
                </ul>
              </div>
            `:""}
          </div>
        </div>
      `:""}_escapeHtml(e){if(!e)return"";let t=document.createElement("div");return t.textContent=e,t.innerHTML}render(){let e=`
      <style>
        ${this.getBaseStyles()}

        :host {
          display: block;
        }

        .memory-browser {
          background: var(--loki-bg-card);
          border: 1px solid var(--loki-border);
          border-radius: 10px;
          overflow: hidden;
        }

        .browser-header {
          padding: 12px 16px;
          border-bottom: 1px solid var(--loki-border);
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .browser-title {
          font-size: 14px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .tabs {
          display: flex;
          border-bottom: 1px solid var(--loki-border);
          background: var(--loki-bg-secondary);
        }

        .tab {
          padding: 10px 16px;
          font-size: 12px;
          font-weight: 500;
          color: var(--loki-text-secondary);
          cursor: pointer;
          border: none;
          background: none;
          display: flex;
          align-items: center;
          gap: 6px;
          transition: all var(--loki-transition);
          border-bottom: 2px solid transparent;
          margin-bottom: -1px;
        }

        .tab:hover {
          color: var(--loki-text-primary);
          background: var(--loki-bg-hover);
        }

        .tab.active {
          color: var(--loki-accent);
          border-bottom-color: var(--loki-accent);
        }

        .tab svg {
          width: 14px;
          height: 14px;
          stroke: currentColor;
          stroke-width: 2;
          fill: none;
        }

        .browser-content {
          padding: 16px;
          min-height: 300px;
          max-height: 500px;
          overflow-y: auto;
          display: flex;
        }

        .content-main {
          flex: 1;
          min-width: 0;
        }

        .loading, .error-state {
          text-align: center;
          padding: 40px;
          color: var(--loki-text-muted);
        }

        .error-state {
          color: var(--loki-red);
        }

        /* Summary styles */
        .summary-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
        }

        .summary-card {
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          padding: 14px;
        }

        .summary-card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        }

        .summary-card-title {
          font-size: 12px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .summary-card-count {
          font-size: 18px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-accent);
        }

        .summary-card-detail {
          font-size: 11px;
          color: var(--loki-text-muted);
          margin-bottom: 8px;
        }

        .summary-card-meta {
          font-size: 10px;
          color: var(--loki-text-secondary);
          margin-bottom: 8px;
        }

        .memory-bar {
          height: 4px;
          background: var(--loki-bg-tertiary);
          border-radius: 2px;
          overflow: hidden;
        }

        .memory-bar-fill {
          height: 100%;
          border-radius: 2px;
          transition: width 0.3s ease;
        }

        .memory-bar-fill.episodic { background: var(--loki-blue); }
        .memory-bar-fill.semantic { background: var(--loki-purple); }
        .memory-bar-fill.procedural { background: var(--loki-green); }

        .token-economics .economics-stats {
          display: flex;
          gap: 16px;
          margin-top: 8px;
        }

        .econ-stat {
          text-align: center;
        }

        .econ-label {
          font-size: 10px;
          color: var(--loki-text-muted);
          display: block;
        }

        .econ-value {
          font-size: 14px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-text-primary);
        }

        .econ-value.savings {
          color: var(--loki-green);
        }

        .summary-actions {
          display: flex;
          gap: 8px;
          margin-top: 16px;
        }

        /* Item list styles */
        .item-list {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .item-card {
          background: var(--loki-bg-secondary);
          border: 1px solid var(--loki-border);
          border-radius: 6px;
          padding: 12px;
          cursor: pointer;
          transition: all var(--loki-transition);
        }

        .item-card:hover {
          border-color: var(--loki-border-light);
          transform: translateX(2px);
        }

        .item-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 6px;
        }

        .item-id {
          font-size: 10px;
          color: var(--loki-accent);
        }

        .item-category {
          font-size: 10px;
          padding: 2px 6px;
          background: var(--loki-bg-tertiary);
          border-radius: 3px;
          color: var(--loki-text-secondary);
        }

        .item-outcome {
          font-size: 9px;
          padding: 2px 6px;
          border-radius: 3px;
          text-transform: uppercase;
          font-weight: 500;
        }

        .item-outcome.success { background: var(--loki-green-muted); color: var(--loki-green); }
        .item-outcome.failure { background: var(--loki-red-muted); color: var(--loki-red); }
        .item-outcome.partial { background: var(--loki-yellow-muted); color: var(--loki-yellow); }

        .confidence-badge {
          font-size: 10px;
          font-weight: 500;
          color: var(--loki-blue);
        }

        .item-title {
          font-size: 12px;
          font-weight: 500;
          color: var(--loki-text-primary);
          margin-bottom: 4px;
        }

        .item-description {
          font-size: 11px;
          color: var(--loki-text-secondary);
          margin-bottom: 4px;
        }

        .item-meta {
          display: flex;
          gap: 12px;
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        /* Detail panel */
        .detail-panel {
          width: 300px;
          min-width: 300px;
          background: var(--loki-bg-secondary);
          border-left: 1px solid var(--loki-border);
          margin: -16px -16px -16px 16px;
          padding: 16px;
          overflow-y: auto;
        }

        .detail-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
        }

        .detail-header h3 {
          font-size: 14px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 20px;
          color: var(--loki-text-muted);
          cursor: pointer;
          padding: 0;
          line-height: 1;
        }

        .close-btn:hover {
          color: var(--loki-text-primary);
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          padding: 6px 0;
          border-bottom: 1px solid var(--loki-border);
          font-size: 12px;
        }

        .detail-label {
          color: var(--loki-text-secondary);
          font-weight: 500;
          font-size: 11px;
          margin-bottom: 6px;
        }

        .detail-value {
          color: var(--loki-text-primary);
        }

        .detail-value.outcome.success { color: var(--loki-green); }
        .detail-value.outcome.failure { color: var(--loki-red); }

        .detail-section {
          margin-top: 16px;
        }

        .detail-content {
          background: var(--loki-bg-tertiary);
          padding: 10px;
          border-radius: 6px;
          font-size: 12px;
          color: var(--loki-text-primary);
        }

        .detail-content.success {
          border-left: 3px solid var(--loki-green);
        }

        .detail-content.error {
          border-left: 3px solid var(--loki-red);
        }

        .detail-list {
          padding-left: 20px;
          font-size: 12px;
          color: var(--loki-text-primary);
        }

        .detail-list li {
          margin-bottom: 4px;
        }

        .action-log {
          background: var(--loki-bg-tertiary);
          border-radius: 6px;
          padding: 8px;
          max-height: 200px;
          overflow-y: auto;
        }

        .action-entry {
          display: flex;
          gap: 8px;
          font-size: 11px;
          padding: 4px 0;
          border-bottom: 1px solid var(--loki-border);
        }

        .action-entry:last-child {
          border-bottom: none;
        }

        .action-time {
          color: var(--loki-text-muted);
          font-family: 'JetBrains Mono', monospace;
        }

        .action-type {
          color: var(--loki-blue);
          font-weight: 500;
        }

        .action-target {
          color: var(--loki-text-secondary);
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .empty-state {
          text-align: center;
          padding: 40px;
          color: var(--loki-text-muted);
          font-size: 12px;
        }
      </style>
    `,t;if(this._loading)t='<div class="loading">Loading memory data...</div>';else if(this._error)t=`<div class="error-state">Error: ${this._error}</div>`;else{let a;switch(this._activeTab){case"summary":a=this._renderSummary();break;case"episodes":a=this._renderEpisodes();break;case"patterns":a=this._renderPatterns();break;case"skills":a=this._renderSkills();break;default:a=this._renderSummary()}t=`
        <div class="content-main">${a}</div>
        ${this._renderDetail()}
      `}this.shadowRoot.innerHTML=`
      ${e}
      <div class="memory-browser">
        <div class="browser-header">
          <span class="browser-title">Memory System</span>
        </div>
        <div class="tabs" role="tablist" aria-label="Memory browser sections">
          ${de.map((a,s)=>`
            <button class="tab ${this._activeTab===a.id?"active":""}"
                    data-tab="${a.id}"
                    role="tab"
                    id="tab-${a.id}"
                    aria-selected="${this._activeTab===a.id}"
                    aria-controls="tabpanel-${a.id}"
                    tabindex="${this._activeTab===a.id?"0":"-1"}">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="${a.icon}"/></svg>
              ${a.label}
            </button>
          `).join("")}
        </div>
        <div class="browser-content" role="tabpanel" id="tabpanel-${this._activeTab}" aria-labelledby="tab-${this._activeTab}">
          ${t}
        </div>
      </div>
    `,this._attachEventListeners()}_attachEventListeners(){let e=this.shadowRoot.querySelectorAll(".tab");e.forEach((i,r)=>{i.addEventListener("click",()=>this._setTab(i.dataset.tab)),i.addEventListener("keydown",o=>{if(o.key==="ArrowRight"||o.key==="ArrowLeft"){o.preventDefault();let d=Array.from(e),p=o.key==="ArrowRight"?(r+1)%d.length:(r-1+d.length)%d.length;d[p].focus(),this._setTab(d[p].dataset.tab)}})}),this.shadowRoot.querySelectorAll(".item-card").forEach(i=>{i.addEventListener("click",()=>this._handleItemClick(i)),i.addEventListener("keydown",r=>{r.key==="Enter"||r.key===" "?(r.preventDefault(),this._handleItemClick(i)):(r.key==="ArrowDown"||r.key==="ArrowUp")&&(r.preventDefault(),this._navigateItemCards(i,r.key==="ArrowDown"?"next":"prev"))})});let t=this.shadowRoot.getElementById("close-detail");t&&t.addEventListener("click",()=>this._closeDetail());let a=this.shadowRoot.getElementById("consolidate-btn");a&&a.addEventListener("click",()=>this._triggerConsolidation());let s=this.shadowRoot.getElementById("refresh-btn");s&&s.addEventListener("click",()=>this._loadData())}_handleItemClick(e){let t=e.dataset.id;switch(e.dataset.type){case"episode":this._selectEpisode(t);break;case"pattern":this._selectPattern(t);break;case"skill":this._selectSkill(t);break}}_navigateItemCards(e,t){let a=Array.from(this.shadowRoot.querySelectorAll(".item-card")),s=a.indexOf(e);if(s===-1)return;let i=t==="next"?s+1:s-1;i>=0&&i<a.length&&a[i].focus()}};customElements.get("loki-memory-browser")||customElements.define("loki-memory-browser",B);var ce=[{id:"1h",label:"1 Hour",hours:1},{id:"24h",label:"24 Hours",hours:24},{id:"7d",label:"7 Days",hours:168},{id:"30d",label:"30 Days",hours:720}],pe=[{id:"all",label:"All Signals"},{id:"user_preference",label:"User Preferences"},{id:"error_pattern",label:"Error Patterns"},{id:"success_pattern",label:"Success Patterns"},{id:"tool_efficiency",label:"Tool Efficiency"},{id:"context_relevance",label:"Context Relevance"}],ue=[{id:"all",label:"All Sources"},{id:"cli",label:"CLI"},{id:"api",label:"API"},{id:"vscode",label:"VS Code"},{id:"mcp",label:"MCP"},{id:"dashboard",label:"Dashboard"}],U=class extends u{static get observedAttributes(){return["api-url","theme","time-range","signal-type","source"]}constructor(){super(),this._loading=!1,this._error=null,this._api=null,this._timeRange="7d",this._signalType="all",this._source="all",this._metrics=null,this._trends=null,this._signals=[],this._selectedMetric=null}connectedCallback(){super.connectedCallback(),this._timeRange=this.getAttribute("time-range")||"7d",this._signalType=this.getAttribute("signal-type")||"all",this._source=this.getAttribute("source")||"all",this._setupApi(),this._loadData()}attributeChangedCallback(e,t,a){if(t!==a)switch(e){case"api-url":this._api&&(this._api.baseUrl=a,this._loadData());break;case"theme":this._applyTheme();break;case"time-range":this._timeRange=a,this._loadData();break;case"signal-type":this._signalType=a,this._loadData();break;case"source":this._source=a,this._loadData();break}}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e})}async _loadData(){this._loading=!0,this._error=null,this.render();try{let e={timeRange:this._timeRange,signalType:this._signalType!=="all"?this._signalType:void 0,source:this._source!=="all"?this._source:void 0},[t,a,s]=await Promise.all([this._api.getLearningMetrics(e).catch(()=>null),this._api.getLearningTrends(e).catch(()=>null),this._api.getLearningSignals({...e,limit:50}).catch(()=>[])]);this._metrics=t,this._trends=a,this._signals=s||[]}catch(e){this._error=e.message||"Failed to load learning data"}this._loading=!1,this.render()}_setFilter(e,t){switch(e){case"timeRange":this._timeRange=t,this.setAttribute("time-range",t);break;case"signalType":this._signalType=t,this.setAttribute("signal-type",t);break;case"source":this._source=t,this.setAttribute("source",t);break}this.dispatchEvent(new CustomEvent("filter-change",{detail:{timeRange:this._timeRange,signalType:this._signalType,source:this._source}})),this._loadData()}_selectMetric(e,t){this._selectedMetric={type:e,item:t},this.dispatchEvent(new CustomEvent("metric-select",{detail:{type:e,item:t}})),this.render()}_closeDetail(){this._selectedMetric=null,this.render()}_formatNumber(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e?.toString()||"0"}_formatPercent(e){return(e*100).toFixed(1)+"%"}_formatDuration(e){return e<60?e.toFixed(0)+"s":e<3600?(e/60).toFixed(1)+"m":(e/3600).toFixed(1)+"h"}_escapeHtml(e){if(!e)return"";let t=document.createElement("div");return t.textContent=e,t.innerHTML}_renderFilters(){return`
      <div class="filters">
        <div class="filter-group">
          <label>Time Range</label>
          <select id="time-range-select" class="filter-select">
            ${ce.map(e=>`
              <option value="${e.id}" ${this._timeRange===e.id?"selected":""}>${e.label}</option>
            `).join("")}
          </select>
        </div>
        <div class="filter-group">
          <label>Signal Type</label>
          <select id="signal-type-select" class="filter-select">
            ${pe.map(e=>`
              <option value="${e.id}" ${this._signalType===e.id?"selected":""}>${e.label}</option>
            `).join("")}
          </select>
        </div>
        <div class="filter-group">
          <label>Source</label>
          <select id="source-select" class="filter-select">
            ${ue.map(e=>`
              <option value="${e.id}" ${this._source===e.id?"selected":""}>${e.label}</option>
            `).join("")}
          </select>
        </div>
        <button class="btn btn-secondary" id="refresh-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
            <polyline points="23 4 23 10 17 10"/>
            <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
          </svg>
          Refresh
        </button>
      </div>
    `}_renderSummaryCards(){if(!this._metrics)return'<div class="empty-state">No metrics available</div>';let{totalSignals:e,signalsByType:t,signalsBySource:a,aggregation:s}=this._metrics;return`
      <div class="summary-cards">
        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Total Signals</span>
            <span class="summary-card-count">${this._formatNumber(e||0)}</span>
          </div>
          <div class="summary-card-detail">Learning signals collected</div>
          <div class="signal-breakdown">
            ${Object.entries(t||{}).map(([i,r])=>`
              <div class="breakdown-item">
                <span class="breakdown-label">${i.replace("_"," ")}</span>
                <span class="breakdown-value">${this._formatNumber(r)}</span>
              </div>
            `).join("")}
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Sources</span>
            <span class="summary-card-count">${Object.keys(a||{}).length}</span>
          </div>
          <div class="summary-card-detail">Signal sources active</div>
          <div class="signal-breakdown">
            ${Object.entries(a||{}).map(([i,r])=>`
              <div class="breakdown-item">
                <span class="breakdown-label source-badge ${i}">${i}</span>
                <span class="breakdown-value">${this._formatNumber(r)}</span>
              </div>
            `).join("")}
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Patterns Found</span>
            <span class="summary-card-count">${this._formatNumber((s?.preferences?.length||0)+(s?.error_patterns?.length||0)+(s?.success_patterns?.length||0))}</span>
          </div>
          <div class="summary-card-detail">Aggregated learnings</div>
          <div class="pattern-counts">
            <div class="pattern-count">
              <span class="pattern-icon preferences">P</span>
              <span>${s?.preferences?.length||0} Preferences</span>
            </div>
            <div class="pattern-count">
              <span class="pattern-icon errors">E</span>
              <span>${s?.error_patterns?.length||0} Errors</span>
            </div>
            <div class="pattern-count">
              <span class="pattern-icon success">S</span>
              <span>${s?.success_patterns?.length||0} Success</span>
            </div>
          </div>
        </div>

        <div class="summary-card">
          <div class="summary-card-header">
            <span class="summary-card-title">Avg Confidence</span>
            <span class="summary-card-count confidence-high">
              ${this._formatPercent(this._metrics.avgConfidence||0)}
            </span>
          </div>
          <div class="summary-card-detail">Signal reliability</div>
          <div class="confidence-bar">
            <div class="confidence-fill" style="width: ${(this._metrics.avgConfidence||0)*100}%"></div>
          </div>
        </div>
      </div>
    `}_renderTrendChart(){if(!this._trends||!this._trends.dataPoints||this._trends.dataPoints.length===0)return'<div class="chart-empty">No trend data available</div>';let{dataPoints:e,maxValue:t}=this._trends,a=120,s=400,i=20,r=e.map((d,p)=>{let D=i+p/(e.length-1||1)*(s-i*2),Y=a-i-d.count/(t||1)*(a-i*2);return`${D},${Y}`}).join(" "),o=`${i},${a-i} ${r} ${s-i},${a-i}`;return`
      <div class="trend-chart">
        <div class="chart-header">
          <span class="chart-title">Signal Volume Over Time</span>
          <span class="chart-subtitle">${this._trends.period}</span>
        </div>
        <svg class="chart-svg" viewBox="0 0 ${s} ${a}">
          <!-- Grid lines -->
          <line x1="${i}" y1="${i}" x2="${i}" y2="${a-i}" stroke="var(--loki-border)" stroke-width="1"/>
          <line x1="${i}" y1="${a-i}" x2="${s-i}" y2="${a-i}" stroke="var(--loki-border)" stroke-width="1"/>

          <!-- Area fill -->
          <polygon points="${o}" fill="var(--loki-accent-muted)" />

          <!-- Trend line -->
          <polyline points="${r}" fill="none" stroke="var(--loki-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

          <!-- Data points -->
          ${e.map((d,p)=>{let D=i+p/(e.length-1||1)*(s-i*2),Y=a-i-d.count/(t||1)*(a-i*2);return`<circle cx="${D}" cy="${Y}" r="3" fill="var(--loki-accent)" />`}).join("")}
        </svg>
        <div class="chart-labels">
          ${e.length>0?`
            <span class="chart-label-start">${e[0].label}</span>
            <span class="chart-label-end">${e[e.length-1].label}</span>
          `:""}
        </div>
      </div>
    `}_renderTopLists(){if(!this._metrics?.aggregation)return"";let{preferences:e,error_patterns:t,success_patterns:a,tool_efficiencies:s}=this._metrics.aggregation;return`
      <div class="top-lists">
        <!-- User Preferences -->
        <div class="top-list">
          <div class="list-header">
            <span class="list-title">Top User Preferences</span>
            <span class="list-count">${e?.length||0}</span>
          </div>
          <div class="list-items" role="list">
            ${(e||[]).slice(0,5).map(i=>`
              <div class="list-item" data-type="preference" data-id="${i.preference_key}" tabindex="0" role="listitem">
                <div class="item-main">
                  <span class="item-key">${this._escapeHtml(i.preference_key)}</span>
                  <span class="item-value">${this._escapeHtml(String(i.preferred_value))}</span>
                </div>
                <div class="item-meta">
                  <span class="item-freq">${i.frequency}x</span>
                  <span class="item-conf">${this._formatPercent(i.confidence)}</span>
                </div>
              </div>
            `).join("")||'<div class="list-empty">No preferences found</div>'}
          </div>
        </div>

        <!-- Error Patterns -->
        <div class="top-list">
          <div class="list-header">
            <span class="list-title">Common Error Patterns</span>
            <span class="list-count">${t?.length||0}</span>
          </div>
          <div class="list-items" role="list">
            ${(t||[]).slice(0,5).map(i=>`
              <div class="list-item error-item" data-type="error_pattern" data-id="${i.error_type}" tabindex="0" role="listitem">
                <div class="item-main">
                  <span class="item-key">${this._escapeHtml(i.error_type)}</span>
                  <span class="resolution-rate ${i.resolution_rate>.5?"good":"poor"}">${this._formatPercent(i.resolution_rate)} resolved</span>
                </div>
                <div class="item-meta">
                  <span class="item-freq">${i.frequency}x</span>
                  <span class="item-conf">${this._formatPercent(i.confidence)}</span>
                </div>
              </div>
            `).join("")||'<div class="list-empty">No error patterns found</div>'}
          </div>
        </div>

        <!-- Success Patterns -->
        <div class="top-list">
          <div class="list-header">
            <span class="list-title">Success Patterns</span>
            <span class="list-count">${a?.length||0}</span>
          </div>
          <div class="list-items" role="list">
            ${(a||[]).slice(0,5).map(i=>`
              <div class="list-item success-item" data-type="success_pattern" data-id="${i.pattern_name}" tabindex="0" role="listitem">
                <div class="item-main">
                  <span class="item-key">${this._escapeHtml(i.pattern_name)}</span>
                  <span class="item-duration">${this._formatDuration(i.avg_duration_seconds)}</span>
                </div>
                <div class="item-meta">
                  <span class="item-freq">${i.frequency}x</span>
                  <span class="item-conf">${this._formatPercent(i.confidence)}</span>
                </div>
              </div>
            `).join("")||'<div class="list-empty">No success patterns found</div>'}
          </div>
        </div>

        <!-- Tool Efficiency -->
        <div class="top-list">
          <div class="list-header">
            <span class="list-title">Tool Efficiency Rankings</span>
            <span class="list-count">${s?.length||0}</span>
          </div>
          <div class="list-items" role="list">
            ${(s||[]).slice(0,5).map((i,r)=>`
              <div class="list-item tool-item" data-type="tool_efficiency" data-id="${i.tool_name}" tabindex="0" role="listitem">
                <div class="item-rank">#${r+1}</div>
                <div class="item-main">
                  <span class="item-key">${this._escapeHtml(i.tool_name)}</span>
                  <span class="efficiency-score">${(i.efficiency_score*100).toFixed(0)}</span>
                </div>
                <div class="item-meta">
                  <span class="success-rate ${i.success_rate>.8?"good":""}">${this._formatPercent(i.success_rate)}</span>
                  <span class="item-time">${i.avg_execution_time_ms.toFixed(0)}ms</span>
                </div>
              </div>
            `).join("")||'<div class="list-empty">No tool data found</div>'}
          </div>
        </div>
      </div>
    `}_renderRecentSignals(){return!this._signals||this._signals.length===0?'<div class="signals-empty">No recent signals</div>':`
      <div class="recent-signals">
        <div class="signals-header">
          <span class="signals-title">Recent Signals</span>
          <span class="signals-count">${this._signals.length}</span>
        </div>
        <div class="signals-list">
          ${this._signals.slice(0,10).map(e=>`
            <div class="signal-item">
              <div class="signal-type ${e.type}">${e.type.replace("_"," ")}</div>
              <div class="signal-content">
                <span class="signal-action">${this._escapeHtml(e.action)}</span>
                <span class="signal-source">${e.source}</span>
              </div>
              <div class="signal-meta">
                <span class="signal-outcome ${e.outcome}">${e.outcome}</span>
                <span class="signal-time">${new Date(e.timestamp).toLocaleTimeString()}</span>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    `}_renderDetailPanel(){if(!this._selectedMetric)return"";let{type:e,item:t}=this._selectedMetric,a="";switch(e){case"preference":a=`
          <div class="detail-row">
            <span class="detail-label">Preference Key</span>
            <span class="detail-value">${this._escapeHtml(t.preference_key)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Preferred Value</span>
            <span class="detail-value">${this._escapeHtml(String(t.preferred_value))}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Frequency</span>
            <span class="detail-value">${t.frequency} occurrences</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Confidence</span>
            <span class="detail-value">${this._formatPercent(t.confidence)}</span>
          </div>
          ${t.alternatives_rejected?.length?`
            <div class="detail-section">
              <div class="detail-label">Alternatives Rejected</div>
              <ul class="detail-list">
                ${t.alternatives_rejected.map(s=>`<li>${this._escapeHtml(s)}</li>`).join("")}
              </ul>
            </div>
          `:""}
        `;break;case"error_pattern":a=`
          <div class="detail-row">
            <span class="detail-label">Error Type</span>
            <span class="detail-value">${this._escapeHtml(t.error_type)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Resolution Rate</span>
            <span class="detail-value">${this._formatPercent(t.resolution_rate)}</span>
          </div>
          ${t.common_messages?.length?`
            <div class="detail-section">
              <div class="detail-label">Common Messages</div>
              <ul class="detail-list">
                ${t.common_messages.map(s=>`<li>${this._escapeHtml(s)}</li>`).join("")}
              </ul>
            </div>
          `:""}
          ${t.resolutions?.length?`
            <div class="detail-section">
              <div class="detail-label">Known Resolutions</div>
              <ul class="detail-list success">
                ${t.resolutions.map(s=>`<li>${this._escapeHtml(s)}</li>`).join("")}
              </ul>
            </div>
          `:""}
        `;break;case"success_pattern":a=`
          <div class="detail-row">
            <span class="detail-label">Pattern Name</span>
            <span class="detail-value">${this._escapeHtml(t.pattern_name)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Avg Duration</span>
            <span class="detail-value">${this._formatDuration(t.avg_duration_seconds)}</span>
          </div>
          ${t.common_actions?.length?`
            <div class="detail-section">
              <div class="detail-label">Common Actions</div>
              <ol class="detail-list numbered">
                ${t.common_actions.map(s=>`<li>${this._escapeHtml(s)}</li>`).join("")}
              </ol>
            </div>
          `:""}
        `;break;case"tool_efficiency":a=`
          <div class="detail-row">
            <span class="detail-label">Tool Name</span>
            <span class="detail-value">${this._escapeHtml(t.tool_name)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Usage Count</span>
            <span class="detail-value">${t.usage_count}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Success Rate</span>
            <span class="detail-value">${this._formatPercent(t.success_rate)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Avg Execution Time</span>
            <span class="detail-value">${t.avg_execution_time_ms.toFixed(0)}ms</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Total Tokens</span>
            <span class="detail-value">${this._formatNumber(t.total_tokens_used)}</span>
          </div>
          ${t.alternative_tools?.length?`
            <div class="detail-section">
              <div class="detail-label">Alternative Tools</div>
              <div class="tag-list">
                ${t.alternative_tools.map(s=>`<span class="tag">${this._escapeHtml(s)}</span>`).join("")}
              </div>
            </div>
          `:""}
        `;break}return`
      <div class="detail-panel">
        <div class="detail-header">
          <h3>${e.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}</h3>
          <button class="close-btn" id="close-detail">&times;</button>
        </div>
        <div class="detail-body">
          ${a}
          <div class="detail-row">
            <span class="detail-label">Sources</span>
            <div class="source-tags">
              ${(t.sources||[]).map(s=>`<span class="source-badge ${s}">${s}</span>`).join("")}
            </div>
          </div>
          <div class="detail-row">
            <span class="detail-label">First Seen</span>
            <span class="detail-value">${t.first_seen?new Date(t.first_seen).toLocaleDateString():"--"}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Last Seen</span>
            <span class="detail-value">${t.last_seen?new Date(t.last_seen).toLocaleDateString():"--"}</span>
          </div>
        </div>
      </div>
    `}render(){let e=`
      <style>
        ${this.getBaseStyles()}

        :host {
          display: block;
        }

        .learning-dashboard {
          background: var(--loki-bg-card);
          border: 1px solid var(--loki-border);
          border-radius: 10px;
          overflow: hidden;
        }

        .dashboard-header {
          padding: 12px 16px;
          border-bottom: 1px solid var(--loki-border);
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .dashboard-title {
          font-size: 14px;
          font-weight: 600;
          color: var(--loki-text-primary);
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .dashboard-title svg {
          color: var(--loki-accent);
        }

        /* Filters */
        .filters {
          display: flex;
          gap: 12px;
          align-items: center;
          padding: 12px 16px;
          background: var(--loki-bg-secondary);
          border-bottom: 1px solid var(--loki-border);
          flex-wrap: wrap;
        }

        .filter-group {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }

        .filter-group label {
          font-size: 10px;
          font-weight: 500;
          color: var(--loki-text-muted);
          text-transform: uppercase;
        }

        .filter-select {
          padding: 6px 10px;
          background: var(--loki-bg-card);
          border: 1px solid var(--loki-border);
          border-radius: 4px;
          font-size: 12px;
          color: var(--loki-text-primary);
          cursor: pointer;
        }

        .filter-select:focus {
          outline: none;
          border-color: var(--loki-accent);
        }

        /* Dashboard Content */
        .dashboard-content {
          padding: 16px;
          display: flex;
          gap: 16px;
          min-height: 400px;
        }

        .content-main {
          flex: 1;
          min-width: 0;
        }

        .loading, .error-state {
          text-align: center;
          padding: 40px;
          color: var(--loki-text-muted);
        }

        .error-state {
          color: var(--loki-red);
        }

        /* Summary Cards */
        .summary-cards {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
          margin-bottom: 20px;
        }

        .summary-card {
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          padding: 14px;
        }

        .summary-card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 6px;
        }

        .summary-card-title {
          font-size: 12px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .summary-card-count {
          font-size: 20px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          color: var(--loki-accent);
        }

        .summary-card-count.confidence-high {
          color: var(--loki-green);
        }

        .summary-card-detail {
          font-size: 11px;
          color: var(--loki-text-muted);
          margin-bottom: 10px;
        }

        .signal-breakdown {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }

        .breakdown-item {
          display: flex;
          justify-content: space-between;
          font-size: 11px;
        }

        .breakdown-label {
          color: var(--loki-text-secondary);
          text-transform: capitalize;
        }

        .breakdown-value {
          color: var(--loki-text-primary);
          font-family: 'JetBrains Mono', monospace;
        }

        .source-badge {
          padding: 2px 6px;
          border-radius: 3px;
          font-size: 9px;
          text-transform: uppercase;
          font-weight: 500;
        }

        .source-badge.cli { background: var(--loki-blue-muted); color: var(--loki-blue); }
        .source-badge.api { background: var(--loki-green-muted); color: var(--loki-green); }
        .source-badge.vscode { background: var(--loki-purple-muted); color: var(--loki-purple); }
        .source-badge.mcp { background: var(--loki-yellow-muted); color: var(--loki-yellow); }
        .source-badge.dashboard { background: var(--loki-accent-muted); color: var(--loki-accent); }

        .pattern-counts {
          display: flex;
          flex-direction: column;
          gap: 6px;
        }

        .pattern-count {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 11px;
          color: var(--loki-text-secondary);
        }

        .pattern-icon {
          width: 18px;
          height: 18px;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 10px;
          font-weight: 600;
        }

        .pattern-icon.preferences { background: var(--loki-blue-muted); color: var(--loki-blue); }
        .pattern-icon.errors { background: var(--loki-red-muted); color: var(--loki-red); }
        .pattern-icon.success { background: var(--loki-green-muted); color: var(--loki-green); }

        .confidence-bar {
          height: 4px;
          background: var(--loki-bg-tertiary);
          border-radius: 2px;
          overflow: hidden;
        }

        .confidence-fill {
          height: 100%;
          background: var(--loki-green);
          border-radius: 2px;
          transition: width 0.3s ease;
        }

        /* Trend Chart */
        .trend-chart {
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          padding: 14px;
          margin-bottom: 20px;
        }

        .chart-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .chart-title {
          font-size: 12px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .chart-subtitle {
          font-size: 11px;
          color: var(--loki-text-muted);
        }

        .chart-svg {
          width: 100%;
          height: 120px;
        }

        .chart-labels {
          display: flex;
          justify-content: space-between;
          font-size: 10px;
          color: var(--loki-text-muted);
          margin-top: 4px;
        }

        .chart-empty {
          text-align: center;
          padding: 40px;
          color: var(--loki-text-muted);
          font-size: 12px;
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          margin-bottom: 20px;
        }

        /* Top Lists */
        .top-lists {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 12px;
          margin-bottom: 20px;
        }

        .top-list {
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          overflow: hidden;
        }

        .list-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 12px;
          background: var(--loki-bg-tertiary);
        }

        .list-title {
          font-size: 11px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .list-count {
          font-size: 10px;
          padding: 2px 6px;
          background: var(--loki-bg-card);
          border-radius: 10px;
          color: var(--loki-text-muted);
        }

        .list-items {
          max-height: 200px;
          overflow-y: auto;
        }

        .list-item {
          padding: 10px 12px;
          border-bottom: 1px solid var(--loki-border);
          cursor: pointer;
          transition: background var(--loki-transition);
        }

        .list-item:hover {
          background: var(--loki-bg-hover);
        }

        .list-item:last-child {
          border-bottom: none;
        }

        .item-main {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 4px;
        }

        .item-key {
          font-size: 12px;
          font-weight: 500;
          color: var(--loki-text-primary);
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .item-value {
          font-size: 11px;
          color: var(--loki-accent);
          margin-left: 8px;
        }

        .item-meta {
          display: flex;
          gap: 12px;
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        .item-freq {
          color: var(--loki-blue);
        }

        .item-conf {
          color: var(--loki-green);
        }

        .item-rank {
          font-size: 11px;
          font-weight: 600;
          color: var(--loki-accent);
          margin-right: 8px;
        }

        .efficiency-score {
          font-family: 'JetBrains Mono', monospace;
          font-size: 12px;
          font-weight: 600;
          color: var(--loki-green);
        }

        .success-rate.good {
          color: var(--loki-green);
        }

        .resolution-rate {
          font-size: 10px;
          padding: 2px 6px;
          border-radius: 3px;
        }

        .resolution-rate.good {
          background: var(--loki-green-muted);
          color: var(--loki-green);
        }

        .resolution-rate.poor {
          background: var(--loki-red-muted);
          color: var(--loki-red);
        }

        .item-duration {
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        .list-empty {
          padding: 20px;
          text-align: center;
          font-size: 11px;
          color: var(--loki-text-muted);
        }

        /* Recent Signals */
        .recent-signals {
          background: var(--loki-bg-secondary);
          border-radius: 8px;
          overflow: hidden;
        }

        .signals-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 12px;
          background: var(--loki-bg-tertiary);
        }

        .signals-title {
          font-size: 11px;
          font-weight: 600;
          color: var(--loki-text-primary);
        }

        .signals-count {
          font-size: 10px;
          padding: 2px 6px;
          background: var(--loki-bg-card);
          border-radius: 10px;
          color: var(--loki-text-muted);
        }

        .signals-list {
          max-height: 300px;
          overflow-y: auto;
        }

        .signal-item {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 8px 12px;
          border-bottom: 1px solid var(--loki-border);
        }

        .signal-item:last-child {
          border-bottom: none;
        }

        .signal-type {
          font-size: 9px;
          padding: 3px 6px;
          border-radius: 3px;
          text-transform: uppercase;
          font-weight: 500;
          white-space: nowrap;
        }

        .signal-type.user_preference { background: var(--loki-blue-muted); color: var(--loki-blue); }
        .signal-type.error_pattern { background: var(--loki-red-muted); color: var(--loki-red); }
        .signal-type.success_pattern { background: var(--loki-green-muted); color: var(--loki-green); }
        .signal-type.tool_efficiency { background: var(--loki-purple-muted); color: var(--loki-purple); }
        .signal-type.context_relevance { background: var(--loki-yellow-muted); color: var(--loki-yellow); }

        .signal-content {
          flex: 1;
          min-width: 0;
        }

        .signal-action {
          font-size: 12px;
          color: var(--loki-text-primary);
          display: block;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .signal-source {
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        .signal-meta {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 2px;
        }

        .signal-outcome {
          font-size: 9px;
          padding: 2px 5px;
          border-radius: 3px;
          text-transform: uppercase;
        }

        .signal-outcome.success { background: var(--loki-green-muted); color: var(--loki-green); }
        .signal-outcome.failure { background: var(--loki-red-muted); color: var(--loki-red); }
        .signal-outcome.partial { background: var(--loki-yellow-muted); color: var(--loki-yellow); }
        .signal-outcome.unknown { background: var(--loki-bg-tertiary); color: var(--loki-text-muted); }

        .signal-time {
          font-size: 10px;
          color: var(--loki-text-muted);
        }

        .signals-empty {
          padding: 30px;
          text-align: center;
          font-size: 12px;
          color: var(--loki-text-muted);
        }

        /* Detail Panel */
        .detail-panel {
          width: 300px;
          min-width: 300px;
          background: var(--loki-bg-secondary);
          border-left: 1px solid var(--loki-border);
          margin: -16px -16px -16px 16px;
          padding: 16px;
          overflow-y: auto;
        }

        .detail-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
        }

        .detail-header h3 {
          font-size: 14px;
          font-weight: 600;
          color: var(--loki-text-primary);
          text-transform: capitalize;
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 20px;
          color: var(--loki-text-muted);
          cursor: pointer;
          padding: 0;
          line-height: 1;
        }

        .close-btn:hover {
          color: var(--loki-text-primary);
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          padding: 8px 0;
          border-bottom: 1px solid var(--loki-border);
          font-size: 12px;
        }

        .detail-label {
          color: var(--loki-text-secondary);
          font-weight: 500;
        }

        .detail-value {
          color: var(--loki-text-primary);
        }

        .detail-section {
          margin-top: 12px;
        }

        .detail-list {
          padding-left: 18px;
          margin-top: 6px;
          font-size: 11px;
          color: var(--loki-text-primary);
        }

        .detail-list li {
          margin-bottom: 4px;
        }

        .detail-list.success li {
          color: var(--loki-green);
        }

        .source-tags {
          display: flex;
          gap: 4px;
          flex-wrap: wrap;
        }

        .tag-list {
          display: flex;
          gap: 4px;
          flex-wrap: wrap;
          margin-top: 6px;
        }

        .tag {
          font-size: 10px;
          padding: 3px 8px;
          background: var(--loki-bg-tertiary);
          border-radius: 4px;
          color: var(--loki-text-secondary);
        }

        .empty-state {
          text-align: center;
          padding: 40px;
          color: var(--loki-text-muted);
          font-size: 12px;
        }
      </style>
    `,t;this._loading?t='<div class="loading">Loading learning metrics...</div>':this._error?t=`<div class="error-state">Error: ${this._error}</div>`:t=`
        <div class="content-main">
          ${this._renderSummaryCards()}
          ${this._renderTrendChart()}
          ${this._renderTopLists()}
          ${this._renderRecentSignals()}
        </div>
        ${this._renderDetailPanel()}
      `,this.shadowRoot.innerHTML=`
      ${e}
      <div class="learning-dashboard">
        <div class="dashboard-header">
          <span class="dashboard-title">
            <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
              <path d="M12 20V10"/>
              <path d="M18 20V4"/>
              <path d="M6 20v-4"/>
            </svg>
            Learning Metrics Dashboard
          </span>
        </div>
        ${this._renderFilters()}
        <div class="dashboard-content">
          ${t}
        </div>
      </div>
    `,this._attachEventListeners()}_attachEventListeners(){let e=this.shadowRoot.getElementById("time-range-select");e&&e.addEventListener("change",r=>this._setFilter("timeRange",r.target.value));let t=this.shadowRoot.getElementById("signal-type-select");t&&t.addEventListener("change",r=>this._setFilter("signalType",r.target.value));let a=this.shadowRoot.getElementById("source-select");a&&a.addEventListener("change",r=>this._setFilter("source",r.target.value));let s=this.shadowRoot.getElementById("refresh-btn");s&&s.addEventListener("click",()=>this._loadData());let i=this.shadowRoot.getElementById("close-detail");i&&i.addEventListener("click",()=>this._closeDetail()),this.shadowRoot.querySelectorAll(".list-item").forEach(r=>{r.addEventListener("click",()=>{let o=r.dataset.type,d=r.dataset.id,p=this._findItemData(o,d);p&&this._selectMetric(o,p)}),r.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),r.click())})})}_findItemData(e,t){if(!this._metrics?.aggregation)return null;switch(e){case"preference":return this._metrics.aggregation.preferences?.find(a=>a.preference_key===t);case"error_pattern":return this._metrics.aggregation.error_patterns?.find(a=>a.error_type===t);case"success_pattern":return this._metrics.aggregation.success_patterns?.find(a=>a.pattern_name===t);case"tool_efficiency":return this._metrics.aggregation.tool_efficiencies?.find(a=>a.tool_name===t);default:return null}}};customElements.get("loki-learning-dashboard")||customElements.define("loki-learning-dashboard",U);var ge=[{id:"overview",label:"Overview"},{id:"decisions",label:"Decision Log"},{id:"convergence",label:"Convergence"},{id:"agents",label:"Agents"}],O=class extends u{static get observedAttributes(){return["api-url","theme"]}constructor(){super(),this._loading=!1,this._error=null,this._api=null,this._activeTab="overview",this._pollInterval=null,this._councilState=null,this._verdicts=[],this._convergence=[],this._agents=[],this._selectedAgent=null,this._lastDataHash=null}connectedCallback(){super.connectedCallback(),this._setupApi(),this._loadData(),this._startPolling()}disconnectedCallback(){super.disconnectedCallback(),this._stopPolling()}attributeChangedCallback(e,t,a){t!==a&&(e==="api-url"&&this._api&&(this._api.baseUrl=a,this._loadData()),e==="theme"&&this._applyTheme())}_setupApi(){let e=this.getAttribute("api-url")||window.location.origin;this._api=g({baseUrl:e})}_startPolling(){this._pollInterval=setInterval(()=>this._loadData(),3e3),this._visibilityHandler=()=>{document.hidden?this._pollInterval&&(clearInterval(this._pollInterval),this._pollInterval=null):this._pollInterval||(this._loadData(),this._pollInterval=setInterval(()=>this._loadData(),3e3))},document.addEventListener("visibilitychange",this._visibilityHandler)}_stopPolling(){this._pollInterval&&(clearInterval(this._pollInterval),this._pollInterval=null),this._visibilityHandler&&(document.removeEventListener("visibilitychange",this._visibilityHandler),this._visibilityHandler=null)}async _loadData(){try{let[t,a,s,i]=await Promise.allSettled([this._api._get("/api/council/state"),this._api._get("/api/council/verdicts"),this._api._get("/api/council/convergence"),this._api._get("/api/agents")]);t.status==="fulfilled"&&(this._councilState=t.value),a.status==="fulfilled"&&(this._verdicts=a.value.verdicts||[]),s.status==="fulfilled"&&(this._convergence=s.value.dataPoints||[]),i.status==="fulfilled"&&(this._agents=Array.isArray(i.value)?i.value:[]),this._error=null}catch(t){this._error=t.message}let e=JSON.stringify({s:this._councilState,v:this._verdicts,c:this._convergence,a:this._agents,e:this._error});e!==this._lastDataHash&&(this._lastDataHash=e,this.render())}async _forceReview(){try{await this._api._post("/api/council/force-review"),this.dispatchEvent(new CustomEvent("council-action",{detail:{action:"force-review"},bubbles:!0}))}catch(e){this._error=`Failed to force review: ${e.message}`,this.render()}}async _killAgent(e){if(confirm(`Kill agent ${e}?`))try{await this._api._post(`/api/agents/${e}/kill`),this.dispatchEvent(new CustomEvent("council-action",{detail:{action:"kill-agent",agentId:e},bubbles:!0})),await this._loadData()}catch(t){this._error=`Failed to kill agent: ${t.message}`,this.render()}}async _pauseAgent(e){try{await this._api._post(`/api/agents/${e}/pause`),await this._loadData()}catch(t){this._error=`Failed to pause agent: ${t.message}`,this.render()}}async _resumeAgent(e){try{await this._api._post(`/api/agents/${e}/resume`),await this._loadData()}catch(t){this._error=`Failed to resume agent: ${t.message}`,this.render()}}_setTab(e){this._activeTab=e,this.render()}_selectAgent(e){this._selectedAgent=this._selectedAgent?.id===e.id?null:e,this.render()}render(){let e=this.shadowRoot;e&&(e.innerHTML=`
      <style>${this.getBaseStyles()}${this._getStyles()}</style>
      <div class="council-dashboard">
        <div class="council-header">
          <div class="header-left">
            <h2 class="title">Completion Council</h2>
            ${this._councilState?.enabled!==!1?'<span class="badge badge-active">Active</span>':'<span class="badge badge-inactive">Disabled</span>'}
          </div>
          <button class="btn btn-primary" onclick="this.getRootNode().host._forceReview()">
            Force Review
          </button>
        </div>

        <div class="tabs">
          ${ge.map(t=>`
            <button
              class="tab ${this._activeTab===t.id?"active":""}"
              onclick="this.getRootNode().host._setTab('${t.id}')"
            >${t.label}</button>
          `).join("")}
        </div>

        <div class="tab-content">
          ${this._renderTabContent()}
        </div>

        ${this._error?`<div class="error-banner">${this._error}</div>`:""}
      </div>
    `)}_renderTabContent(){switch(this._activeTab){case"overview":return this._renderOverview();case"decisions":return this._renderDecisions();case"convergence":return this._renderConvergence();case"agents":return this._renderAgents();default:return""}}_renderOverview(){let e=this._councilState||{},t=e.consecutive_no_change||0,a=e.done_signals||0,s=e.total_votes||0,i=e.approve_votes||0,r=this._verdicts.length>0?this._verdicts[this._verdicts.length-1]:null,o=this._agents.filter(d=>d.alive).length;return`
      <div class="overview-grid">
        <div class="stat-card">
          <div class="stat-label">Council Status</div>
          <div class="stat-value ${e.enabled!==!1?"text-green":"text-muted"}">
            ${e.enabled!==!1?"Monitoring":"Disabled"}
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Votes Cast</div>
          <div class="stat-value">${s}</div>
          <div class="stat-sub">${i} approved</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Stagnation Streak</div>
          <div class="stat-value ${t>=3?"text-warn":""}">${t}</div>
          <div class="stat-sub">consecutive no-change</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Done Signals</div>
          <div class="stat-value ${a>=2?"text-green":""}">${a}</div>
          <div class="stat-sub">from agent output</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Active Agents</div>
          <div class="stat-value">${o}</div>
          <div class="stat-sub">of ${this._agents.length} total</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last Verdict</div>
          <div class="stat-value ${r?.result==="APPROVED"?"text-green":"text-muted"}">
            ${r?r.result:"None"}
          </div>
          ${r?`<div class="stat-sub">iteration ${r.iteration}</div>`:""}
        </div>
      </div>

      ${this._convergence.length>0?`
        <div class="section">
          <h3 class="section-title">Convergence Trend</h3>
          <div class="convergence-mini">
            ${this._renderConvergenceBar()}
          </div>
        </div>
      `:""}
    `}_renderConvergenceBar(){let e=this._convergence.slice(-20);if(e.length===0)return'<span class="text-muted">No data</span>';let t=Math.max(...e.map(a=>a.files_changed),1);return`
      <div class="bar-chart">
        ${e.map(a=>{let s=Math.max(4,a.files_changed/t*60),i=a.no_change_streak>0;return`
            <div class="bar-wrapper" title="Iter ${a.iteration}: ${a.files_changed} files changed">
              <div class="bar ${i?"bar-stagnant":"bar-active"}" style="height: ${s}px"></div>
              <div class="bar-label">${a.iteration}</div>
            </div>
          `}).join("")}
      </div>
    `}_renderDecisions(){return this._verdicts.length===0?`<div class="empty-state">No council decisions yet. The council convenes every ${this._councilState?.check_interval||5} iterations.</div>`:`
      <div class="decision-list">
        ${this._verdicts.slice().reverse().map(e=>`
          <div class="decision-card ${e.result==="APPROVED"?"decision-approved":"decision-rejected"}">
            <div class="decision-header">
              <span class="decision-result ${e.result==="APPROVED"?"text-green":"text-warn"}">
                ${e.result}
              </span>
              <span class="decision-iter">Iteration ${e.iteration}</span>
              <span class="decision-time">${this._formatTime(e.timestamp)}</span>
            </div>
            <div class="decision-votes">
              <span class="vote-approve">${e.approve} Approve</span>
              <span class="vote-reject">${e.reject} Reject</span>
            </div>
          </div>
        `).join("")}
      </div>
    `}_renderConvergence(){return this._convergence.length===0?'<div class="empty-state">No convergence data available yet.</div>':`
      <div class="section">
        <h3 class="section-title">Files Changed Per Iteration</h3>
        <div class="convergence-chart">
          ${this._renderConvergenceBar()}
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">Convergence Log</h3>
        <div class="convergence-table">
          <table>
            <thead>
              <tr>
                <th>Iteration</th>
                <th>Files Changed</th>
                <th>No-Change Streak</th>
                <th>Done Signals</th>
              </tr>
            </thead>
            <tbody>
              ${this._convergence.slice().reverse().map(e=>`
                <tr class="${e.no_change_streak>=3?"row-warn":""}">
                  <td>${e.iteration}</td>
                  <td>${e.files_changed}</td>
                  <td>${e.no_change_streak}</td>
                  <td>${e.done_signals}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      </div>
    `}_renderAgents(){if(this._agents.length===0)return'<div class="empty-state">No agents registered.</div>';let e=`
      <div class="agents-list">
        ${this._agents.map((t,a)=>`
          <div class="agent-card ${this._selectedAgent?.id===t.id?"agent-selected":""}"
               data-agent-index="${a}">
            <div class="agent-header">
              <span class="agent-name">${t.name||t.id||"Unknown"}</span>
              <span class="agent-status ${t.alive?"status-alive":"status-dead"}">
                ${t.alive?"Running":"Stopped"}
              </span>
            </div>
            <div class="agent-meta">
              ${t.type?`<span class="agent-type">${t.type}</span>`:""}
              ${t.pid?`<span class="agent-pid">PID: ${t.pid}</span>`:""}
              ${t.task?`<span class="agent-task">Task: ${t.task}</span>`:""}
            </div>
            ${this._selectedAgent?.id===t.id?`
              <div class="agent-actions">
                ${t.alive?`
                  <button class="btn btn-sm btn-warn" data-action="pause" data-agent-id="${t.id||t.name}">
                    Pause
                  </button>
                  <button class="btn btn-sm btn-danger" data-action="kill" data-agent-id="${t.id||t.name}">
                    Kill
                  </button>
                `:`
                  <button class="btn btn-sm btn-primary" data-action="resume" data-agent-id="${t.id||t.name}">
                    Resume
                  </button>
                `}
              </div>
            `:""}
          </div>
        `).join("")}
      </div>
    `;return requestAnimationFrame(()=>{let t=this.shadowRoot;t&&t.querySelectorAll(".agent-card[data-agent-index]").forEach(a=>{let s=parseInt(a.dataset.agentIndex,10),i=this._agents[s];i&&(a.addEventListener("click",()=>this._selectAgent(i)),a.querySelectorAll("[data-action]").forEach(r=>{r.addEventListener("click",o=>{o.stopPropagation();let d=r.dataset.action,p=r.dataset.agentId;d==="pause"?this._pauseAgent(p):d==="kill"?this._killAgent(p):d==="resume"&&this._resumeAgent(p)})}))})}),e}_formatTime(e){if(!e)return"";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return e}}_getStyles(){return`
      :host {
        display: block;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        color: var(--loki-text-primary);
      }

      .council-dashboard {
        padding: 16px;
      }

      .council-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
      }

      .badge {
        font-size: 11px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge-active {
        background: var(--loki-success-muted);
        color: var(--loki-success);
        border: 1px solid var(--loki-success-muted);
      }

      .badge-inactive {
        background: var(--loki-bg-hover);
        color: var(--loki-text-muted);
        border: 1px solid var(--loki-border-light);
      }

      .tabs {
        display: flex;
        gap: 2px;
        border-bottom: 1px solid var(--loki-border);
        margin-bottom: 16px;
      }

      .tab {
        padding: 8px 16px;
        background: none;
        border: none;
        color: var(--loki-text-muted);
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: all 0.15s ease;
      }

      .tab:hover {
        color: var(--loki-text-primary);
      }

      .tab.active {
        color: var(--loki-accent);
        border-bottom-color: var(--loki-accent);
      }

      .btn {
        padding: 6px 14px;
        border: 1px solid var(--loki-border);
        border-radius: 6px;
        background: var(--loki-bg-tertiary);
        color: var(--loki-text-primary);
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.15s ease;
      }

      .btn:hover {
        background: var(--loki-accent);
        border-color: var(--loki-accent);
        color: white;
      }

      .btn-primary {
        background: var(--loki-accent);
        border-color: var(--loki-accent);
        color: white;
      }

      .btn-primary:hover {
        background: var(--loki-accent-hover);
      }

      .btn-sm {
        padding: 4px 10px;
        font-size: 11px;
      }

      .btn-warn {
        background: var(--loki-warning-muted);
        border-color: var(--loki-warning-muted);
        color: var(--loki-warning);
      }

      .btn-warn:hover {
        background: var(--loki-warning-muted);
        opacity: 0.85;
      }

      .btn-danger {
        background: var(--loki-error-muted);
        border-color: var(--loki-error-muted);
        color: var(--loki-error);
      }

      .btn-danger:hover {
        background: var(--loki-error-muted);
        opacity: 0.85;
      }

      /* Overview Grid */
      .overview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: var(--loki-bg-card);
        border: 1px solid var(--loki-border);
        border-radius: 8px;
        padding: 14px;
      }

      .stat-label {
        font-size: 11px;
        font-weight: 500;
        color: var(--loki-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        line-height: 1.2;
      }

      .stat-sub {
        font-size: 11px;
        color: var(--loki-text-muted);
        margin-top: 2px;
      }

      .text-green { color: var(--loki-success); }
      .text-warn { color: var(--loki-warning); }
      .text-muted { color: var(--loki-text-muted); }

      /* Section */
      .section {
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--loki-text-secondary);
      }

      /* Bar Chart */
      .bar-chart {
        display: flex;
        align-items: flex-end;
        gap: 4px;
        height: 80px;
        padding: 8px;
        background: var(--loki-bg-card);
        border: 1px solid var(--loki-border);
        border-radius: 8px;
      }

      .bar-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        min-width: 0;
      }

      .bar {
        width: 100%;
        max-width: 24px;
        border-radius: 3px 3px 0 0;
        transition: height 0.3s ease;
      }

      .bar-active {
        background: var(--loki-accent);
      }

      .bar-stagnant {
        background: var(--loki-warning-muted);
      }

      .bar-label {
        font-size: 9px;
        color: var(--loki-text-muted);
        margin-top: 4px;
      }

      /* Decision List */
      .decision-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .decision-card {
        background: var(--loki-bg-card);
        border: 1px solid var(--loki-border);
        border-radius: 8px;
        padding: 12px 16px;
        border-left: 3px solid transparent;
      }

      .decision-approved {
        border-left-color: var(--loki-success);
      }

      .decision-rejected {
        border-left-color: var(--loki-error);
      }

      .decision-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 6px;
      }

      .decision-result {
        font-weight: 600;
        font-size: 13px;
      }

      .decision-iter {
        font-size: 12px;
        color: var(--loki-text-secondary);
      }

      .decision-time {
        font-size: 11px;
        color: var(--loki-text-muted);
        margin-left: auto;
      }

      .decision-votes {
        display: flex;
        gap: 16px;
        font-size: 12px;
      }

      .vote-approve {
        color: var(--loki-success);
      }

      .vote-reject {
        color: var(--loki-error);
      }

      /* Convergence Table */
      .convergence-table {
        background: var(--loki-bg-card);
        border: 1px solid var(--loki-border);
        border-radius: 8px;
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      th {
        text-align: left;
        padding: 10px 14px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--loki-text-muted);
        border-bottom: 1px solid var(--loki-border);
        background: var(--loki-bg-tertiary);
      }

      td {
        padding: 8px 14px;
        border-bottom: 1px solid var(--loki-border);
      }

      tr:last-child td {
        border-bottom: none;
      }

      .row-warn {
        background: var(--loki-warning-muted);
      }

      /* Agent List */
      .agents-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .agent-card {
        background: var(--loki-bg-card);
        border: 1px solid var(--loki-border);
        border-radius: 8px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.15s ease;
      }

      .agent-card:hover {
        border-color: var(--loki-accent);
      }

      .agent-selected {
        border-color: var(--loki-accent);
        background: var(--loki-accent-muted);
      }

      .agent-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }

      .agent-name {
        font-weight: 600;
        font-size: 13px;
      }

      .agent-status {
        font-size: 11px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 10px;
      }

      .status-alive {
        background: var(--loki-success-muted);
        color: var(--loki-success);
      }

      .status-dead {
        background: var(--loki-bg-hover);
        color: var(--loki-text-muted);
      }

      .agent-meta {
        display: flex;
        gap: 12px;
        font-size: 11px;
        color: var(--loki-text-muted);
      }

      .agent-actions {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid var(--loki-border);
      }

      /* Empty State */
      .empty-state {
        padding: 40px;
        text-align: center;
        color: var(--loki-text-muted);
        font-size: 13px;
      }

      /* Error Banner */
      .error-banner {
        margin-top: 12px;
        padding: 10px 14px;
        background: var(--loki-error-muted);
        border: 1px solid var(--loki-error-muted);
        border-radius: 6px;
        color: var(--loki-error);
        font-size: 12px;
      }
    `}};customElements.get("loki-council-dashboard")||customElements.define("loki-council-dashboard",O);var he="1.3.0";function ve(l={}){return l.theme?h.setTheme(l.theme):l.autoDetectContext!==!1?h.init():S.init(),l.apiUrl&&g({baseUrl:l.apiUrl}),{theme:h.getTheme(),context:h.detectContext()}}return ne(me);})();


// Initialize dashboard when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  // Initialize the dashboard with auto-detect
  var initResult = LokiDashboard.init({ autoDetectContext: true });
  console.log('Loki Dashboard initialized:', initResult);

  // Theme toggle functionality
  var themeToggle = document.getElementById('theme-toggle');
  var themeLabel = document.getElementById('theme-label');

  function updateThemeLabel() {
    var theme = LokiDashboard.UnifiedThemeManager.getTheme();
    themeLabel.textContent = theme.includes('dark') ? 'Light' : 'Dark';
  }

  themeToggle.addEventListener('click', function() {
    LokiDashboard.UnifiedThemeManager.toggle();
    updateThemeLabel();
  });

  // Initialize theme label
  updateThemeLabel();

  // API URL configuration - auto-detect from current server
  var apiUrlInput = document.getElementById('api-url');
  var connectBtn = document.getElementById('connect-btn');
  var detectedUrl = window.location.origin;
  apiUrlInput.value = detectedUrl;

  function updateComponentsApiUrl(apiUrl) {
    var components = [
      'task-board',
      'session-control',
      'log-stream',
      'memory-browser',
      'learning-dashboard',
      'council-dashboard'
    ];
    components.forEach(function(id) {
      var el = document.getElementById(id);
      if (el) el.setAttribute('api-url', apiUrl);
    });
    console.log('API URL updated:', apiUrl);
  }

  // Auto-connect to current server on load
  updateComponentsApiUrl(detectedUrl);

  connectBtn.addEventListener('click', function() {
    updateComponentsApiUrl(apiUrlInput.value);
  });

  // Offline detection
  window.addEventListener('online', function() {
    document.getElementById('offline-banner').classList.remove('show');
  });

  window.addEventListener('offline', function() {
    document.getElementById('offline-banner').classList.add('show');
  });

  if (!navigator.onLine) {
    document.getElementById('offline-banner').classList.add('show');
  }

  // Mobile menu toggle
  var mobileMenuBtn = document.getElementById('mobile-menu-btn');
  var sidebar = document.getElementById('sidebar');

  mobileMenuBtn.addEventListener('click', function() {
    sidebar.classList.toggle('mobile-open');
  });

  document.addEventListener('click', function(e) {
    if (window.innerWidth <= 768 &&
        sidebar.classList.contains('mobile-open') &&
        !sidebar.contains(e.target) &&
        !mobileMenuBtn.contains(e.target)) {
      sidebar.classList.remove('mobile-open');
    }
  });

  // --- Section Navigation ---
  var navLinks = document.querySelectorAll('.nav-link');
  var mainContent = document.getElementById('main-content');

  function switchSection(sectionId) {
    var pageEl = document.getElementById('page-' + sectionId);
    if (pageEl) {
      pageEl.scrollIntoView({ behavior: 'smooth' });
    }
    navLinks.forEach(function(link) { link.classList.remove('active'); });
    var navEl = document.querySelector('.nav-link[data-section="' + sectionId + '"]');
    if (navEl) navEl.classList.add('active');
    localStorage.setItem('loki-active-section', sectionId);
  }

  navLinks.forEach(function(link) {
    link.addEventListener('click', function() {
      switchSection(link.dataset.section);
      // Close mobile sidebar
      if (window.innerWidth <= 768) {
        sidebar.classList.remove('mobile-open');
      }
    });
  });

  // IntersectionObserver to track active section on scroll
  var sectionPages = document.querySelectorAll('.section-page');
  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
        var sectionId = entry.target.id.replace('page-', '');
        navLinks.forEach(function(link) { link.classList.remove('active'); });
        var navEl = document.querySelector('.nav-link[data-section="' + sectionId + '"]');
        if (navEl) navEl.classList.add('active');
      }
    });
  }, { root: mainContent, threshold: 0.3 });

  sectionPages.forEach(function(page) { observer.observe(page); });

  // Keyboard shortcuts: Cmd/Ctrl + 1-6
  document.addEventListener('keydown', function(e) {
    if ((e.metaKey || e.ctrlKey) && e.key >= '1' && e.key <= '6') {
      e.preventDefault();
      var sections = ['overview', 'tasks', 'logs', 'memory', 'learning', 'council'];
      switchSection(sections[parseInt(e.key) - 1]);
    }
  });

  // Restore last section from localStorage
  var savedSection = localStorage.getItem('loki-active-section');
  if (savedSection) {
    setTimeout(function() { switchSection(savedSection); }, 100);
  }

  // Add initial log entry and verify connection
  setTimeout(function() {
    var logStream = document.getElementById('log-stream');
    if (logStream && logStream.addLog) {
      logStream.addLog('Dashboard initialized', 'success');
      logStream.addLog('Connecting to ' + detectedUrl + '...', 'info');
      fetch(detectedUrl + '/health').then(function(r) {
        return r.json();
      }).then(function(data) {
        if (data.status === 'healthy') {
          logStream.addLog('Connected to API', 'success');
        }
      }).catch(function() {
        logStream.addLog('API not reachable at ' + detectedUrl, 'error');
      });
    }
  }, 500);

  // Overview cards polling
  function updateOverviewCards() {
    fetch(detectedUrl + '/api/status').then(function(r) {
      return r.json();
    }).then(function(data) {
      var statusEl = document.getElementById('overview-status');
      var iterEl = document.getElementById('overview-iteration');
      var tasksEl = document.getElementById('overview-tasks');
      var modelEl = document.getElementById('overview-model');
      if (statusEl) statusEl.textContent = (data.status || data.state || 'idle').toUpperCase();
      if (iterEl) iterEl.textContent = data.iteration || data.current_iteration || '0';
      if (modelEl) modelEl.textContent = data.model || data.current_model || '--';
      if (tasksEl) {
        var total = (data.tasks_completed || 0) + (data.tasks_remaining || 0);
        tasksEl.textContent = total > 0 ? (data.tasks_completed || 0) + '/' + total : '--';
      }
    }).catch(function() {});
  }
  updateOverviewCards();
  setInterval(updateOverviewCards, 5000);
});
  </script>
</body>
</html>